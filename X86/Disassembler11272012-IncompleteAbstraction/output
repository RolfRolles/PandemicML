1,2c1,3
< (* TODO:  General cleanup at this point.  Clean up language regarding 
<    modrm_mem_reg_predicate vs. _discriminator 
---
> (* TODO:  General cleanup at this point.  Introduce the oM operand functor for 
>    the LEA instruction; clean up language regarding modrm_mem_reg_predicate vs.
>    _discriminator 
6,10c7
< 
<    OIbAsOpndSize
<    OMbBx
<    OMbEbx
< *)
---
>    *)
13d9
< open X86InternalOperand
317,319d312
< 
< (* Points to either a 16- or 32-bit quantity *)
< let oM    () = modrm_mem_reg_predicate (lazy (addrsize_predicate (lazy (oMw ())) (lazy (oMd ())))) (lazy (invalid ()))
321c314
< let oMp   () = modrm_mem_reg_predicate (lazy (opsize_predicate   (lazy (oMd ())) (lazy (oMf ())))) (lazy (invalid ()))
---
> let oMp   () = modrm_mem_reg_predicate (lazy (opsize_predicate (lazy (oMd ())) (lazy (oMf ())))) (lazy (invalid ()))
323c316
< let oMa   () = modrm_mem_reg_predicate (lazy (opsize_predicate   (lazy (oMd ())) (lazy (oMq ())))) (lazy (invalid ()))
---
> let oMa   () = modrm_mem_reg_predicate (lazy (opsize_predicate (lazy (oMd ())) (lazy (oMq ())))) (lazy (invalid ()))
403,405c396,398
< let oRw () = modrm_mem_reg_predicate (lazy (raise (InvalidInstruction))) (lazy (opnd_reg16_of_int))
< let oRd () = modrm_mem_reg_predicate (lazy (raise (InvalidInstruction))) (lazy (opnd_reg32_of_int))
< let oRv () = modrm_mem_reg_predicate (lazy (raise (InvalidInstruction))) (lazy (opsize_predicate (lazy opnd_reg16_of_int) (lazy opnd_reg32_of_int)))
---
> let oRw () = modrm_mem_reg_predicate (lazy (invalid ())) (lazy (opnd_reg16_of_int))
> let oRd () = modrm_mem_reg_predicate (lazy (invalid ())) (lazy (opnd_reg32_of_int))
> let oRv () = modrm_mem_reg_predicate (lazy (invalid ())) (lazy (opsize_predicate (lazy opnd_reg16_of_int) (lazy opnd_reg32_of_int)))
471,478c464,471
< | 0 -> FPUReg(ST0)
< | 1 -> FPUReg(ST1)
< | 2 -> FPUReg(ST2)
< | 3 -> FPUReg(ST3)
< | 4 -> FPUReg(ST4)
< | 5 -> FPUReg(ST5)
< | 6 -> FPUReg(ST6)
< | 7 -> FPUReg(ST7)
---
> | 0 -> oSt0
> | 1 -> fun () -> FPUReg(ST1)
> | 2 -> fun () -> FPUReg(ST2)
> | 3 -> fun () -> FPUReg(ST3)
> | 4 -> fun () -> FPUReg(ST4)
> | 5 -> fun () -> FPUReg(ST5)
> | 6 -> fun () -> FPUReg(ST6)
> | 7 -> fun () -> FPUReg(ST7)
481,482d473
< let oStN () = oSt_of_int (Int32.to_int (Int32.logand !modrm_context.modrmbyte 0x7l))
< 
490,612d480
< let function_of_x86_abstract_operand = function
< | OAL        -> oAL
< | OALR8L     -> oALR8L
< | OCL        -> oCL
< | OCLR9L     -> oCLR9L
< | ODLR10L    -> oDLR10L
< | OBLR11L    -> oBLR11L
< | OAHR12L    -> oAHR12L
< | OCHR13L    -> oCHR13L
< | ODHR14L    -> oDHR14L
< | OBHR15L    -> oBHR15L
< | OAX        -> oAX
< | ODX        -> oDX
< | OeAX       -> oeAX
< | OrAXr8     -> orAXr8
< | OrAX       -> orAX
< | OeCX       -> oeCX
< | OrCXr9     -> orCXr9
< | OeDX       -> oeDX
< | OrDXr10    -> orDXr10
< | OeBX       -> oeBX
< | OrBXr11    -> orBXr11
< | OeSP       -> oeSP
< | OrSPr12    -> orSPr12
< | OeBP       -> oeBP
< | OrBPr13    -> orBPr13
< | OeSI       -> oeSI
< | OrSIr14    -> orSIr14
< | OeDI       -> oeDI
< | OrDIr15    -> orDIr15
< | OCS        -> oCS
< | ODS        -> oDS
< | OES        -> oES
< | OGS        -> oGS
< | OFS        -> oFS
< | OSS        -> oSS
< | OSw        -> oSw
< | OCd        -> oCd
< | ODd        -> oDd
< | OIb        -> oIb
< | OIw        -> oIw
< | OIv        -> oIv
< | OIz        -> oIz
< | O1         -> o1
< | OGb        -> oGb
< | OGw        -> oGw
< | OGd        -> oGd
< | OGv        -> oGv
< | OGd_q      -> oGd_q
< | OGz        -> oGz
< | ORw        -> oRw
< | ORd        -> oRd
< | ORv        -> oRv
< | OMb        -> oMb
< | OMw        -> oMw
< | OMd        -> oMd
< | OMs        -> oMs
< | OMq        -> oMq
< | OMdq       -> oMdq
< | OMd_q      -> oMd_q
< | OMa        -> oMa
< | OMp        -> oMp
< | OMpd       -> oMpd
< | OMps       -> oMps
< | OM         -> oM
< | OEb        -> oEb
< | OEw        -> oEw
< | OEd        -> oEd
< | OEv        -> oEv
< | OEd_q      -> oEd_q
< | OOb        -> oOb
< | OOv        -> oOv
< | OAp        -> oAp
< | OJb        -> oJb
< | OJz        -> oJz
< | OXb        -> oXb
< | OXv        -> oXv
< | OXz        -> oXz
< | OYb        -> oYb
< | OYv        -> oYv
< | OYz        -> oYz
< | OSt0       -> oSt0
< | OStN       -> oStN
< | OFPEnv     -> oFPEnv
< | OFPEnvLow  -> oFPEnvLow
< | OReal4     -> oReal4
< | OReal8     -> oReal8
< | OReal10    -> oReal10
< | ONq        -> oNq
< | OPd        -> oPd
< | OPq        -> oPq
< | OPpi       -> oPpi
< | OVdq       -> oVdq
< | OVpd       -> oVpd
< | OVps       -> oVps
< | OVsd       -> oVsd
< | OVss       -> oVss
< | OVq        -> oVq
< | OUps       -> oUps
< | OUpd       -> oUpd
< | OUq        -> oUq
< | OUdq       -> oUdq
< | OQpi       -> oQpi
< | OQd        -> oQd
< | OQq        -> oQq
< | OWdq       -> oWdq
< | OWps       -> oWps
< | OWpd       -> oWpd
< | OWq        -> oWq
< | OWss       -> oWss
< | OWsd       -> oWsd
< | OSimdState -> oSimdState
< | OUdq_Md    -> oUdqMd
< | OUdq_Mq    -> oUdqMq
< | OUdq_Mw    -> oUdqMw
< | ORd_Mb     -> oRdMb
< | ORd_Mw     -> oRdMw
< | OXw        -> failwith "OXw"
< | OXd        -> failwith "OXd"
< | OYw        -> failwith "OYw"
< | OYd        -> failwith "OYd"
< 
< 
614c482
< type x86_operand_producer = x86_abstract_operand
---
> type x86_operand_producer = unit -> x86operand
619c487,488
< 
---
>                | PRED_AddrOpSize  of x86_instruction_producer * x86_instruction_producer * 
>                                      x86_instruction_producer * x86_instruction_producer (* A16O16, A16O32, A32O16, A32O32 *)
626a496
> | LowFun of (int -> x86_specifier) (* Function on modrm.rm *)
636,650c506,520
< Direct(Add,[OEb;OGb]); (* 0x00 *)
< Direct(Add,[OEv;OGv]);
< Direct(Add,[OGb;OEb]);
< Direct(Add,[OGv;OEv]);
< Direct(Add,[OAL;OIb]);
< Direct(Add,[OrAX;OIz]);
< Direct(Push,[OES]);
< Direct(Pop,[OES]);
< Direct(Or,[OEb;OGb]);
< Direct(Or,[OEv;OGv]);
< Direct(Or,[OGb;OEb]);
< Direct(Or,[OGv;OEv]);
< Direct(Or,[OAL;OIb]);
< Direct(Or,[OrAX;OIz]);
< Direct(Push,[OCS]);
---
> Direct(Add,[oEb;oGb]); (* 0x00 *)
> Direct(Add,[oEv;oGv]);
> Direct(Add,[oGb;oEb]);
> Direct(Add,[oGv;oEv]);
> Direct(Add,[oAL;oIb]);
> Direct(Add,[orAX;oIz]);
> Direct(Push,[oES]);
> Direct(Pop,[oES]);
> Direct(Or,[oEb;oGb]);
> Direct(Or,[oEv;oGv]);
> Direct(Or,[oGb;oEb]);
> Direct(Or,[oGv;oEv]);
> Direct(Or,[oAL;oIb]);
> Direct(Or,[orAX;oIz]);
> Direct(Push,[oCS]);
652,673c522,543
< Direct(Adc,[OEb;OGb]); (* 0x10 *)
< Direct(Adc,[OEv;OGv]);
< Direct(Adc,[OGb;OEb]);
< Direct(Adc,[OGv;OEv]);
< Direct(Adc,[OAL;OIb]);
< Direct(Adc,[OrAX;OIz]);
< Direct(Push,[OSS]);
< Direct(Pop,[OSS]);
< Direct(Sbb,[OEb;OGb]);
< Direct(Sbb,[OEv;OGv]);
< Direct(Sbb,[OGb;OEb]);
< Direct(Sbb,[OGv;OEv]);
< Direct(Sbb,[OAL;OIb]);
< Direct(Sbb,[OrAX;OIz]);
< Direct(Push,[ODS]);
< Direct(Pop,[ODS]);
< Direct(And,[OEb;OGb]); (* 0x20 *)
< Direct(And,[OEv;OGv]);
< Direct(And,[OGb;OEb]);
< Direct(And,[OGv;OEv]);
< Direct(And,[OAL;OIb]);
< Direct(And,[OrAX;OIz]);
---
> Direct(Adc,[oEb;oGb]); (* 0x10 *)
> Direct(Adc,[oEv;oGv]);
> Direct(Adc,[oGb;oEb]);
> Direct(Adc,[oGv;oEv]);
> Direct(Adc,[oAL;oIb]);
> Direct(Adc,[orAX;oIz]);
> Direct(Push,[oSS]);
> Direct(Pop,[oSS]);
> Direct(Sbb,[oEb;oGb]);
> Direct(Sbb,[oEv;oGv]);
> Direct(Sbb,[oGb;oEb]);
> Direct(Sbb,[oGv;oEv]);
> Direct(Sbb,[oAL;oIb]);
> Direct(Sbb,[orAX;oIz]);
> Direct(Push,[oDS]);
> Direct(Pop,[oDS]);
> Direct(And,[oEb;oGb]); (* 0x20 *)
> Direct(And,[oEv;oGv]);
> Direct(And,[oGb;oEb]);
> Direct(And,[oGv;oEv]);
> Direct(And,[oAL;oIb]);
> Direct(And,[orAX;oIz]);
676,681c546,551
< Direct(Sub,[OEb;OGb]);
< Direct(Sub,[OEv;OGv]);
< Direct(Sub,[OGb;OEb]);
< Direct(Sub,[OGv;OEv]);
< Direct(Sub,[OAL;OIb]);
< Direct(Sub,[OrAX;OIz]);
---
> Direct(Sub,[oEb;oGb]);
> Direct(Sub,[oEv;oGv]);
> Direct(Sub,[oGb;oEb]);
> Direct(Sub,[oGv;oEv]);
> Direct(Sub,[oAL;oIb]);
> Direct(Sub,[orAX;oIz]);
684,689c554,559
< Direct(Xor,[OEb;OGb]); (* 0x30 *)
< Direct(Xor,[OEv;OGv]);
< Direct(Xor,[OGb;OEb]);
< Direct(Xor,[OGv;OEv]);
< Direct(Xor,[OAL;OIb]);
< Direct(Xor,[OrAX;OIz]);
---
> Direct(Xor,[oEb;oGb]); (* 0x30 *)
> Direct(Xor,[oEv;oGv]);
> Direct(Xor,[oGb;oEb]);
> Direct(Xor,[oGv;oEv]);
> Direct(Xor,[oAL;oIb]);
> Direct(Xor,[orAX;oIz]);
692,697c562,567
< Direct(Cmp,[OEb;OGb]);
< Direct(Cmp,[OEv;OGv]);
< Direct(Cmp,[OGb;OEb]);
< Direct(Cmp,[OGv;OEv]);
< Direct(Cmp,[OAL;OIb]);
< Direct(Cmp,[OrAX;OIz]);
---
> Direct(Cmp,[oEb;oGb]);
> Direct(Cmp,[oEv;oGv]);
> Direct(Cmp,[oGb;oEb]);
> Direct(Cmp,[oGv;oEv]);
> Direct(Cmp,[oAL;oIb]);
> Direct(Cmp,[orAX;oIz]);
700,731c570,601
< Direct(Inc,[OeAX]);    (* 0x40 *)
< Direct(Inc,[OeCX]);
< Direct(Inc,[OeDX]);
< Direct(Inc,[OeBX]);
< Direct(Inc,[OeSP]);
< Direct(Inc,[OeBP]);
< Direct(Inc,[OeSI]);
< Direct(Inc,[OeDI]);
< Direct(Dec,[OeAX]);
< Direct(Dec,[OeCX]);
< Direct(Dec,[OeDX]);
< Direct(Dec,[OeBX]);
< Direct(Dec,[OeSP]);
< Direct(Dec,[OeBP]);
< Direct(Dec,[OeSI]);
< Direct(Dec,[OeDI]);
< Direct(Push,[OrAXr8]);    (* 0x50 *)
< Direct(Push,[OrCXr9]);
< Direct(Push,[OrDXr10]);
< Direct(Push,[OrBXr11]);
< Direct(Push,[OrSPr12]);
< Direct(Push,[OrBPr13]);
< Direct(Push,[OrSIr14]);
< Direct(Push,[OrDIr15]);
< Direct(Pop,[OrAXr8]);
< Direct(Pop,[OrCXr9]);
< Direct(Pop,[OrDXr10]);
< Direct(Pop,[OrBXr11]);
< Direct(Pop,[OrSPr12]);
< Direct(Pop,[OrBPr13]);
< Direct(Pop,[OrSIr14]);
< Direct(Pop,[OrDIr15]);
---
> Direct(Inc,[oeAX]);    (* 0x40 *)
> Direct(Inc,[oeCX]);
> Direct(Inc,[oeDX]);
> Direct(Inc,[oeBX]);
> Direct(Inc,[oeSP]);
> Direct(Inc,[oeBP]);
> Direct(Inc,[oeSI]);
> Direct(Inc,[oeDI]);
> Direct(Dec,[oeAX]);
> Direct(Dec,[oeCX]);
> Direct(Dec,[oeDX]);
> Direct(Dec,[oeBX]);
> Direct(Dec,[oeSP]);
> Direct(Dec,[oeBP]);
> Direct(Dec,[oeSI]);
> Direct(Dec,[oeDI]);
> Direct(Push,[orAXr8]);    (* 0x50 *)
> Direct(Push,[orCXr9]);
> Direct(Push,[orDXr10]);
> Direct(Push,[orBXr11]);
> Direct(Push,[orSPr12]);
> Direct(Push,[orBPr13]);
> Direct(Push,[orSIr14]);
> Direct(Push,[orDIr15]);
> Direct(Pop,[orAXr8]);
> Direct(Pop,[orCXr9]);
> Direct(Pop,[orDXr10]);
> Direct(Pop,[orBXr11]);
> Direct(Pop,[orSPr12]);
> Direct(Pop,[orBPr13]);
> Direct(Pop,[orSIr14]);
> Direct(Pop,[orDIr15]);
734,735c604,605
< Direct(Bound,[OGv;OMa]);
< Direct(Arpl,[OEw;OGw]);
---
> Direct(Bound,[oGv;oMa]);
> Direct(Arpl,[oEw;oGw]);
740,779c610,649
< Direct(Push,[OIz]);
< Direct(Imul,[OGv;OEv;OIz]);
< Direct(Push,[OIbAsOpndSize]);
< Direct(Imul,[OGv;OEv;OIb]);
< Direct(Insb,[OYb;ODX]);
< Predicated(PRED_OpSize(Direct(Insw,[OYz;ODX]),Direct(Insd,[OYz;ODX]))); (* Insw /Insd, [OYz;ODX] -- Mnem changes, given a mode *)
< Direct(Outsb,[ODX;OXb]);
< Predicated(PRED_OpSize(Direct(Outsw,[ODX;OXz]),Direct(Outsd,[ODX;OXz]))); (* Outsw /Outsd, [ODX;OXz] -- Mnem changes, given a mode *)
< Direct(Jo ,[OJb]); (* 0x70 *)
< Direct(Jno,[OJb]);
< Direct(Jb ,[OJb]);
< Direct(Jae,[OJb]);
< Direct(Jz ,[OJb]);
< Direct(Jnz,[OJb]);
< Direct(Jbe,[OJb]);
< Direct(Ja ,[OJb]);
< Direct(Js ,[OJb]);
< Direct(Jns,[OJb]);
< Direct(Jp ,[OJb]);
< Direct(Jnp,[OJb]);
< Direct(Jl ,[OJb]);
< Direct(Jge,[OJb]);
< Direct(Jle,[OJb]);
< Direct(Jg ,[OJb]);
< Group([|Direct(Add,[OEb;OIb]);Direct(Or,[OEb;OIb]);Direct(Adc,[OEb;OIb]);Direct(Sbb,[OEb;OIb]);Direct(And,[OEb;OIb]);Direct(Sub,[OEb;OIb]);Direct(Xor,[OEb;OIb]);Direct(Cmp,[OEb;OIb])|]); (* 0x80 *)
< Group([|Direct(Add,[OEv;OIz]);Direct(Or,[OEv;OIz]);Direct(Adc,[OEv;OIz]);Direct(Sbb,[OEv;OIz]);Direct(And,[OEv;OIz]);Direct(Sub,[OEv;OIz]);Direct(Xor,[OEv;OIz]);Direct(Cmp,[OEv;OIz])|]);
< Group([|Direct(Add,[OEb;OIb]);Direct(Or,[OEb;OIb]);Direct(Adc,[OEb;OIb]);Direct(Sbb,[OEb;OIb]);Direct(And,[OEb;OIb]);Direct(Sub,[OEb;OIb]);Direct(Xor,[OEb;OIb]);Direct(Cmp,[OEb;OIb])|]);
< Group([|Direct(Add,[OEv;(*OIbAsOpndSize*)]);Direct(Or,[OEv;(*OIbAsOpndSize*)]);Direct(Adc,[OEv;(*OIbAsOpndSize*)]);Direct(Sbb,[OEv;(*OIbAsOpndSize*)]);Direct(And,[OEv;(*OIbAsOpndSize*)]);Direct(Sub,[OEv;(*OIbAsOpndSize*)]);Direct(Xor,[OEv;(*OIbAsOpndSize*)]);Direct(Cmp,[OEv;(*OIbAsOpndSize*)])|]);
< Direct(Test,[OEb;OGb]);
< Direct(Test,[OEv;OGv]);
< Direct(Xchg,[OEb;OGb]);
< Direct(Xchg,[OEv;OGv]);
< Direct(Mov,[OEb;OGb]);
< Direct(Mov,[OEv;OGv]);
< Direct(Mov,[OGb;OEb]);
< Direct(Mov,[OGv;OEv]);
< Direct(Mov,[OEv;OSw]);
< Direct(Lea,[OGv;OM]);
< Direct(Mov,[OSw;OEw]);
< Group([|Direct(Pop,[OEv]);Invalid;Invalid;Invalid;Invalid;Invalid;Invalid;Invalid|]);
---
> Direct(Push,[oIz]);
> Direct(Imul,[oGv;oEv;oIz]);
> Direct(Push,[oIbAsOpndSize]);
> Direct(Imul,[oGv;oEv;oIb]);
> Direct(Insb,[oYb;oDX]);
> Predicated(PRED_OpSize(Direct(Insw,[oYz;oDX]),Direct(Insd,[oYz;oDX]))); (* Insw /Insd, [oYz;oDX] -- Mnem changes, given a mode *)
> Direct(Outsb,[oDX;oXb]);
> Predicated(PRED_OpSize(Direct(Outsw,[oDX;oXz]),Direct(Outsd,[oDX;oXz]))); (* Outsw /Outsd, [oDX;oXz] -- Mnem changes, given a mode *)
> Direct(Jo ,[oJb]); (* 0x70 *)
> Direct(Jno,[oJb]);
> Direct(Jb ,[oJb]);
> Direct(Jae,[oJb]);
> Direct(Jz ,[oJb]);
> Direct(Jnz,[oJb]);
> Direct(Jbe,[oJb]);
> Direct(Ja ,[oJb]);
> Direct(Js ,[oJb]);
> Direct(Jns,[oJb]);
> Direct(Jp ,[oJb]);
> Direct(Jnp,[oJb]);
> Direct(Jl ,[oJb]);
> Direct(Jge,[oJb]);
> Direct(Jle,[oJb]);
> Direct(Jg ,[oJb]);
> Group([|Direct(Add,[oEb;oIb]);Direct(Or,[oEb;oIb]);Direct(Adc,[oEb;oIb]);Direct(Sbb,[oEb;oIb]);Direct(And,[oEb;oIb]);Direct(Sub,[oEb;oIb]);Direct(Xor,[oEb;oIb]);Direct(Cmp,[oEb;oIb])|]); (* 0x80 *)
> Group([|Direct(Add,[oEv;oIz]);Direct(Or,[oEv;oIz]);Direct(Adc,[oEv;oIz]);Direct(Sbb,[oEv;oIz]);Direct(And,[oEv;oIz]);Direct(Sub,[oEv;oIz]);Direct(Xor,[oEv;oIz]);Direct(Cmp,[oEv;oIz])|]);
> Group([|Direct(Add,[oEb;oIb]);Direct(Or,[oEb;oIb]);Direct(Adc,[oEb;oIb]);Direct(Sbb,[oEb;oIb]);Direct(And,[oEb;oIb]);Direct(Sub,[oEb;oIb]);Direct(Xor,[oEb;oIb]);Direct(Cmp,[oEb;oIb])|]);
> Group([|Direct(Add,[oEv;oIbAsOpndSize]);Direct(Or,[oEv;oIbAsOpndSize]);Direct(Adc,[oEv;oIbAsOpndSize]);Direct(Sbb,[oEv;oIbAsOpndSize]);Direct(And,[oEv;oIbAsOpndSize]);Direct(Sub,[oEv;oIbAsOpndSize]);Direct(Xor,[oEv;oIbAsOpndSize]);Direct(Cmp,[oEv;oIbAsOpndSize])|]);
> Direct(Test,[oEb;oGb]);
> Direct(Test,[oEv;oGv]);
> Direct(Xchg,[oEb;oGb]);
> Direct(Xchg,[oEv;oGv]);
> Direct(Mov,[oEb;oGb]);
> Direct(Mov,[oEv;oGv]);
> Direct(Mov,[oGb;oEb]);
> Direct(Mov,[oGv;oEv]);
> Direct(Mov,[oEv;oSw]);
> Predicated(PRED_ModRMMemReg(Predicated(PRED_AddrOpSize(Direct(Lea,[oGw;oMw]),Direct(Lea,[oGd;oMw]),Direct(Lea,[oGw;oMd]),Direct(Lea,[oGd;oMd]))),Invalid));
> Direct(Mov,[oSw;oEw]);
> Group([|Direct(Pop,[oEv]);Invalid;Invalid;Invalid;Invalid;Invalid;Invalid;Invalid|]);
781,787c651,657
< Direct(Xchg,[OrAX;OrCXr9]);
< Direct(Xchg,[OrAX;OrDXr10]);
< Direct(Xchg,[OrAX;OrBXr11]);
< Direct(Xchg,[OrAX;OrSPr12]);
< Direct(Xchg,[OrAX;OrBPr13]);
< Direct(Xchg,[OrAX;OrSIr14]);
< Direct(Xchg,[OrAX;OrDIr15]);
---
> Direct(Xchg,[orAX;orCXr9]);
> Direct(Xchg,[orAX;orDXr10]);
> Direct(Xchg,[orAX;orBXr11]);
> Direct(Xchg,[orAX;orSPr12]);
> Direct(Xchg,[orAX;orBPr13]);
> Direct(Xchg,[orAX;orSIr14]);
> Direct(Xchg,[orAX;orDIr15]);
790c660
< Direct(CallF,[OAp]);
---
> Direct(CallF,[oAp]);
796,830c666,700
< Direct(Mov,[OAL;OOb]);  (* 0xA0 *)
< Direct(Mov,[OrAX;OOv]);
< Direct(Mov,[OOb;OAL]);
< Direct(Mov,[OOv;OrAX]);
< Direct(Movsb,[OXb;OYb]);
< Predicated(PRED_OpSize(Direct(Movsw,[OXv;OYv]),Direct(Movsd,[OXv;OYv]))); (* MOVS/W/D/Q *)
< Direct(Cmpsb,[OXb;OYb]);
< Predicated(PRED_OpSize(Direct(Cmpsw,[OXv;OYv]),Direct(Cmpsd,[OXv;OYv]))); (* CMPS/W/D/Q *)
< Direct(Test,[OAL;OIb]);
< Direct(Test,[OrAX;OIz]);
< Direct(Stosb,[OYb]);
< Predicated(PRED_OpSize(Direct(Stosw,[OYv]),Direct(Stosd,[OYv]))); (* STOS/W/D/Q *)
< Direct(Lodsb,[OXb]);
< Predicated(PRED_OpSize(Direct(Lodsw,[OXv]),Direct(Lodsd,[OXv]))); (* LODS/W/D/Q *)
< Direct(Scasb,[OYb]);
< Predicated(PRED_OpSize(Direct(Scasw,[OYv]),Direct(Scasd,[OYv]))); (* SCAS/W/D/Q *)
< Direct(Mov,[OALR8L;OIb]); (* 0xB0 *)
< Direct(Mov,[OCLR9L;OIb]);
< Direct(Mov,[ODLR10L;OIb]);
< Direct(Mov,[OBLR11L;OIb]);
< Direct(Mov,[OAHR12L;OIb]);
< Direct(Mov,[OCHR13L;OIb]);
< Direct(Mov,[ODHR14L;OIb]);
< Direct(Mov,[OBHR15L;OIb]);
< Direct(Mov,[OrAXr8;OIv]);
< Direct(Mov,[OrCXr9;OIv]);
< Direct(Mov,[OrDXr10;OIv]);
< Direct(Mov,[OrBXr11;OIv]);
< Direct(Mov,[OrSPr12;OIv]);
< Direct(Mov,[OrBPr13;OIv]);
< Direct(Mov,[OrSIr14;OIv]);
< Direct(Mov,[OrDIr15;OIv]);
< Group([|Direct(Rol,[OEb;OIb]);Direct(Ror,[OEb;OIb]);Direct(Rcl,[OEb;OIb]);Direct(Rcr,[OEb;OIb]);Direct(Shl,[OEb;OIb]);Direct(Shr,[OEb;OIb]);Direct(Sal,[OEb;OIb]);Direct(Sar,[OEb;OIb])|]); (* 0xC0 *)
< Group([|Direct(Rol,[OEv;OIb]);Direct(Ror,[OEv;OIb]);Direct(Rcl,[OEv;OIb]);Direct(Rcr,[OEv;OIb]);Direct(Shl,[OEv;OIb]);Direct(Shr,[OEv;OIb]);Direct(Sal,[OEv;OIb]);Direct(Sar,[OEv;OIb])|]);
< Direct(Ret,[OIw]);
---
> Direct(Mov,[oAL;oOb]);  (* 0xA0 *)
> Direct(Mov,[orAX;oOv]);
> Direct(Mov,[oOb;oAL]);
> Direct(Mov,[oOv;orAX]);
> Direct(Movsb,[oXb;oYb]);
> Predicated(PRED_OpSize(Direct(Movsw,[oXv;oYv]),Direct(Movsd,[oXv;oYv]))); (* MOVS/W/D/Q *)
> Direct(Cmpsb,[oXb;oYb]);
> Predicated(PRED_OpSize(Direct(Cmpsw,[oXv;oYv]),Direct(Cmpsd,[oXv;oYv]))); (* CMPS/W/D/Q *)
> Direct(Test,[oAL;oIb]);
> Direct(Test,[orAX;oIz]);
> Direct(Stosb,[oYb]);
> Predicated(PRED_OpSize(Direct(Stosw,[oYv]),Direct(Stosd,[oYv]))); (* STOS/W/D/Q *)
> Direct(Lodsb,[oXb]);
> Predicated(PRED_OpSize(Direct(Lodsw,[oXv]),Direct(Lodsd,[oXv]))); (* LODS/W/D/Q *)
> Direct(Scasb,[oYb]);
> Predicated(PRED_OpSize(Direct(Scasw,[oYv]),Direct(Scasd,[oYv]))); (* SCAS/W/D/Q *)
> Direct(Mov,[oALR8L;oIb]); (* 0xB0 *)
> Direct(Mov,[oCLR9L;oIb]);
> Direct(Mov,[oDLR10L;oIb]);
> Direct(Mov,[oBLR11L;oIb]);
> Direct(Mov,[oAHR12L;oIb]);
> Direct(Mov,[oCHR13L;oIb]);
> Direct(Mov,[oDHR14L;oIb]);
> Direct(Mov,[oBHR15L;oIb]);
> Direct(Mov,[orAXr8;oIv]);
> Direct(Mov,[orCXr9;oIv]);
> Direct(Mov,[orDXr10;oIv]);
> Direct(Mov,[orBXr11;oIv]);
> Direct(Mov,[orSPr12;oIv]);
> Direct(Mov,[orBPr13;oIv]);
> Direct(Mov,[orSIr14;oIv]);
> Direct(Mov,[orDIr15;oIv]);
> Group([|Direct(Rol,[oEb;oIb]);Direct(Ror,[oEb;oIb]);Direct(Rcl,[oEb;oIb]);Direct(Rcr,[oEb;oIb]);Direct(Shl,[oEb;oIb]);Direct(Shr,[oEb;oIb]);Direct(Sal,[oEb;oIb]);Direct(Sar,[oEb;oIb])|]); (* 0xC0 *)
> Group([|Direct(Rol,[oEv;oIb]);Direct(Ror,[oEv;oIb]);Direct(Rcl,[oEv;oIb]);Direct(Rcr,[oEv;oIb]);Direct(Shl,[oEv;oIb]);Direct(Shr,[oEv;oIb]);Direct(Sal,[oEv;oIb]);Direct(Sar,[oEv;oIb])|]);
> Direct(Ret,[oIw]);
832,836c702,706
< Direct(Les,[OGz;OMp]);
< Direct(Lds,[OGz;OMp]);
< Group([|Direct(Mov,[OEb;OIb]);Invalid;Invalid;Invalid;Invalid;Invalid;Invalid;Invalid|]);
< Group([|Direct(Mov,[OEv;OIz]);Invalid;Invalid;Invalid;Invalid;Invalid;Invalid;Invalid|]);
< Direct(Enter,[OIw;OIb]);
---
> Direct(Les,[oGz;oMp]);
> Direct(Lds,[oGz;oMp]);
> Group([|Direct(Mov,[oEb;oIb]);Invalid;Invalid;Invalid;Invalid;Invalid;Invalid;Invalid|]);
> Group([|Direct(Mov,[oEv;oIz]);Invalid;Invalid;Invalid;Invalid;Invalid;Invalid;Invalid|]);
> Direct(Enter,[oIw;oIb]);
838c708
< Direct(Retf,[OIw]);
---
> Direct(Retf,[oIw]);
841c711
< Direct(Int,[OIb]);
---
> Direct(Int,[oIb]);
844,849c714,719
< Group([|Direct(Rol,[OEb;O1 ]);Direct(Ror,[OEb;O1 ]);Direct(Rcl,[OEb;O1 ]);Direct(Rcr,[OEb;O1 ]);Direct(Shl,[OEb;O1 ]);Direct(Shr,[OEb;O1 ]);Direct(Sal,[OEb;O1 ]);Direct(Sar,[OEb;O1 ])|]); (* 0xD0 *)
< Group([|Direct(Rol,[OEv;O1 ]);Direct(Ror,[OEv;O1 ]);Direct(Rcl,[OEv;O1 ]);Direct(Rcr,[OEv;O1 ]);Direct(Shl,[OEv;O1 ]);Direct(Shr,[OEv;O1 ]);Direct(Sal,[OEv;O1 ]);Direct(Sar,[OEv;O1 ])|]);
< Group([|Direct(Rol,[OEb;OCL]);Direct(Ror,[OEb;OCL]);Direct(Rcl,[OEb;OCL]);Direct(Rcr,[OEb;OCL]);Direct(Shl,[OEb;OCL]);Direct(Shr,[OEb;OCL]);Direct(Sal,[OEb;OCL]);Direct(Sar,[OEb;OCL])|]);
< Group([|Direct(Rol,[OEv;OCL]);Direct(Ror,[OEv;OCL]);Direct(Rcl,[OEv;OCL]);Direct(Rcr,[OEv;OCL]);Direct(Shl,[OEv;OCL]);Direct(Shr,[OEv;OCL]);Direct(Sal,[OEv;OCL]);Direct(Sar,[OEv;OCL])|]);
< Direct(Aam,[OIb]);
< Direct(Aad,[OIb]);
---
> Group([|Direct(Rol,[oEb;o1 ]);Direct(Ror,[oEb;o1 ]);Direct(Rcl,[oEb;o1 ]);Direct(Rcr,[oEb;o1 ]);Direct(Shl,[oEb;o1 ]);Direct(Shr,[oEb;o1 ]);Direct(Sal,[oEb;o1 ]);Direct(Sar,[oEb;o1 ])|]); (* 0xD0 *)
> Group([|Direct(Rol,[oEv;o1 ]);Direct(Ror,[oEv;o1 ]);Direct(Rcl,[oEv;o1 ]);Direct(Rcr,[oEv;o1 ]);Direct(Shl,[oEv;o1 ]);Direct(Shr,[oEv;o1 ]);Direct(Sal,[oEv;o1 ]);Direct(Sar,[oEv;o1 ])|]);
> Group([|Direct(Rol,[oEb;oCL]);Direct(Ror,[oEb;oCL]);Direct(Rcl,[oEb;oCL]);Direct(Rcr,[oEb;oCL]);Direct(Shl,[oEb;oCL]);Direct(Shr,[oEb;oCL]);Direct(Sal,[oEb;oCL]);Direct(Sar,[oEb;oCL])|]);
> Group([|Direct(Rol,[oEv;oCL]);Direct(Ror,[oEv;oCL]);Direct(Rcl,[oEv;oCL]);Direct(Rcr,[oEv;oCL]);Direct(Shl,[oEv;oCL]);Direct(Shr,[oEv;oCL]);Direct(Sal,[oEv;oCL]);Direct(Sar,[oEv;oCL])|]);
> Direct(Aam,[oIb]);
> Direct(Aad,[oIb]);
851c721
< Predicated(PRED_AddrSize(Direct(Xlat,[(*OMbBx*)]),Direct(Xlat,[(*OMbEbx*)])));
---
> Predicated(PRED_AddrSize(Direct(Xlat,[oMbBx]),Direct(Xlat,[oMbEbx])));
873,889c743,759
<     Direct(Fadd, [OSt0;OReal4]);
<     Direct(Fmul, [OSt0;OReal4]);
<     Direct(Fcom, [OSt0;OReal4]);
<     Direct(Fcomp,[OSt0;OReal4]);
<     Direct(Fsub, [OSt0;OReal4]);
<     Direct(Fsubr,[OSt0;OReal4]);
<     Direct(Fdiv, [OSt0;OReal4]);
<     Direct(Fdivr,[OSt0;OReal4])|]),
<   Group([|
<     Direct(Fadd, [OSt0;OStN]);
<     Direct(Fmul, [OSt0;OStN]);
<     Direct(Fcom, [OSt0;OStN]);
<     Direct(Fcomp,[OSt0;OStN]);
<     Direct(Fsub, [OSt0;OStN]);
<     Direct(Fsubr,[OSt0;OStN]);
<     Direct(Fdiv, [OSt0;OStN]);
<     Direct(Fdivr,[OSt0;OStN])|])));
---
>     Direct(Fadd, [oSt0;oReal4]);
>     Direct(Fmul, [oSt0;oReal4]);
>     Direct(Fcom, [oSt0;oReal4]);
>     Direct(Fcomp,[oSt0;oReal4]);
>     Direct(Fsub, [oSt0;oReal4]);
>     Direct(Fsubr,[oSt0;oReal4]);
>     Direct(Fdiv, [oSt0;oReal4]);
>     Direct(Fdivr,[oSt0;oReal4])|]),
>   Group([|
>     LowFun(fun st -> Fadd, [oSt0;oSt_of_int st]);
>     LowFun(fun st -> Fmul, [oSt0;oSt_of_int st]);
>     LowFun(fun st -> Fcom, [oSt0;oSt_of_int st]);
>     LowFun(fun st -> Fcomp,[oSt0;oSt_of_int st]);
>     LowFun(fun st -> Fsub, [oSt0;oSt_of_int st]);
>     LowFun(fun st -> Fsubr,[oSt0;oSt_of_int st]);
>     LowFun(fun st -> Fdiv, [oSt0;oSt_of_int st]);
>     LowFun(fun st -> Fdivr,[oSt0;oSt_of_int st])|])));
894c764
<     Direct(Fld,   [OReal4]);
---
>     Direct(Fld,   [oReal4]);
896,905c766,775
<     Direct(Fst,   [OReal4]);
<     Direct(Fstp,  [OReal4]);
<     Direct(Fldenv,[OFPEnvLow]);
<     Direct(Fldcw, [OMw]);
<     Direct(Fstenv,[OFPEnvLow]);
<     Direct(Fstcw, [OMw])|]),
<   Group([|
<     Direct(Fld, [OSt0;OStN]);
<     Direct(Fxch,[OSt0;OStN]);
<     LowGroup([|Direct(Fnop,[]);Invalid;Invalid;Invalid;Invalid;Invalid;Invalid;Invalid|]);
---
>     Direct(Fst,   [oReal4]);
>     Direct(Fstp,  [oReal4]);
>     Direct(Fldenv,[oFPEnvLow]);
>     Direct(Fldcw, [oMw]);
>     Direct(Fstenv,[oFPEnvLow]);
>     Direct(Fstcw, [oMw])|]),
>   Group([|
>     LowFun(fun st -> Fld, [oSt0;oSt_of_int st]);
>     LowFun(fun st -> Fxch,[oSt0;oSt_of_int st]);
>     LowFun(function | 0 -> Fnop,[] | _ -> invalid ());
907c777
<     LowGroup([|Direct(Fchs,[]);Direct(Fabs,[]);Invalid;Invalid;Direct(Ftst,[]);Direct(Fxam,[]);Invalid;Invalid|]);
---
>     LowFun(function | 0 -> Fchs,[] | 1 -> Fabs,[] | 4 -> Ftst,[] | 5 -> Fxam,[] | _ -> invalid ());
939,951c809,821
<     Direct(Fiadd, [OMd]);
<     Direct(Fimul, [OMd]);
<     Direct(Ficom, [OMd]);
<     Direct(Ficomp,[OMd]);
<     Direct(Fisub, [OMd]);
<     Direct(Fisubr,[OMd]);
<     Direct(Fidiv, [OMd]);
<     Direct(Fidivr,[OMd]);|]),
<   Group([|
<     Direct(Fcmovb ,[OSt0;OStN]);
<     Direct(Fcmove ,[OSt0;OStN]);
<     Direct(Fcmovbe,[OSt0;OStN]);
<     Direct(Fcmovu ,[OSt0;OStN]);
---
>     Direct(Fiadd, [oMd]);
>     Direct(Fimul, [oMd]);
>     Direct(Ficom, [oMd]);
>     Direct(Ficomp,[oMd]);
>     Direct(Fisub, [oMd]);
>     Direct(Fisubr,[oMd]);
>     Direct(Fidiv, [oMd]);
>     Direct(Fidivr,[oMd]);|]),
>   Group([|
>     LowFun(fun st -> Fcmovb, [oSt0;oSt_of_int st]);
>     LowFun(fun st -> Fcmove, [oSt0;oSt_of_int st]);
>     LowFun(fun st -> Fcmovbe,[oSt0;oSt_of_int st]);
>     LowFun(fun st -> Fcmovu, [oSt0;oSt_of_int st]);
953c823
<     LowGroup([|Invalid;Direct(Fucompp,[]);Invalid;Invalid;Invalid;Invalid;Invalid;Invalid|]);
---
>     LowFun(function | 1 -> Fucompp,[] | _ -> invalid ());
960,975c830,845
<     Direct(Fild,  [OMd]);
<     Direct(Fisttp,[OMd]);
<     Direct(Fist,  [OMd]);
<     Direct(Fistp, [OMd]);
<     Invalid;
<     Direct(Fld,   [OReal10]);
<     Invalid;
<     Direct(Fstp,  [OReal10])|]),
<   Group([|
<     Direct(Fcmovnb, [OSt0;OStN]);
<     Direct(Fcmovne, [OSt0;OStN]);
<     Direct(Fcmovnbe,[OSt0;OStN]);
<     Direct(Fcmovnu, [OSt0;OStN]);
<     LowGroup([|Invalid;Invalid;Direct(Fclex,[]);Direct(Finit,[]);Invalid;Invalid;Invalid;Invalid|]);
<     Direct(Fucomi,  [OSt0;OStN]);
<     Direct(Fcomi,   [OSt0;OStN]);
---
>     Direct(Fild,  [oMd]);
>     Direct(Fisttp,[oMd]);
>     Direct(Fist,  [oMd]);
>     Direct(Fistp, [oMd]);
>     Invalid;
>     Direct(Fld,   [oReal10]);
>     Invalid;
>     Direct(Fstp,  [oReal10])|]),
>   Group([|
>     LowFun(fun st -> Fcmovnb, [oSt0;oSt_of_int st]);
>     LowFun(fun st -> Fcmovne, [oSt0;oSt_of_int st]);
>     LowFun(fun st -> Fcmovnbe,[oSt0;oSt_of_int st]);
>     LowFun(fun st -> Fcmovnu, [oSt0;oSt_of_int st]);
>     LowFun(function | 2 -> Fclex,[] | 3 -> Finit,[] | _ -> invalid ());
>     LowFun(fun st -> Fucomi,[oSt0;oSt_of_int st]);
>     LowFun(fun st -> Fcomi, [oSt0;oSt_of_int st]);
981,997c851,867
<     Direct(Fadd, [OSt0;OReal8]);
<     Direct(Fmul, [OSt0;OReal8]);
<     Direct(Fcom, [OSt0;OReal8]);
<     Direct(Fcomp,[OSt0;OReal8]);
<     Direct(Fsub, [OSt0;OReal8]);
<     Direct(Fsubr,[OSt0;OReal8]);
<     Direct(Fdiv, [OSt0;OReal8]);
<     Direct(Fdivr,[OSt0;OReal8])|]),
<   Group([|
<     Direct(Fadd, [OStN;OSt0]);
<     Direct(Fmul, [OStN;OSt0]);
<     Invalid;
<     Invalid;
<     Direct(Fsub, [OStN;OSt0]);
<     Direct(Fsubr,[OStN;OSt0]);
<     Direct(Fdiv, [OStN;OSt0]);
<     Direct(Fdivr,[OStN;OSt0])|])));
---
>     Direct(Fadd, [oSt0;oReal8]);
>     Direct(Fmul, [oSt0;oReal8]);
>     Direct(Fcom, [oSt0;oReal8]);
>     Direct(Fcomp,[oSt0;oReal8]);
>     Direct(Fsub, [oSt0;oReal8]);
>     Direct(Fsubr,[oSt0;oReal8]);
>     Direct(Fdiv, [oSt0;oReal8]);
>     Direct(Fdivr,[oSt0;oReal8])|]),
>   Group([|
>     LowFun(fun st -> Fadd, [oSt_of_int st;oSt0]);
>     LowFun(fun st -> Fmul, [oSt_of_int st;oSt0]);
>     Invalid;
>     Invalid;
>     LowFun(fun st -> Fsub, [oSt_of_int st;oSt0]);
>     LowFun(fun st -> Fsubr,[oSt_of_int st;oSt0]);
>     LowFun(fun st -> Fdiv, [oSt_of_int st;oSt0]);
>     LowFun(fun st -> Fdivr,[oSt_of_int st;oSt0])|])));
1001,1015c871,885
<     Direct(Fld,   [OReal8]);
<     Direct(Fisttp,[OMq]);
<     Direct(Fst,   [OReal8]);
<     Direct(Fstp,  [OReal8]);
<     Direct(Frstor,[OFPEnv]);
<     Invalid;
<     Direct(Fsave ,[OFPEnv]);
<     Direct(Fstsw, [OMw])|]),
<   Group([|
<     Direct(Ffree, [OStN]);
<     Invalid;
<     Direct(Fst,   [OStN]);
<     Direct(Fstp,  [OStN]);
<     Direct(Fucom, [OStN]);
<     Direct(Fucomp,[OStN]);
---
>     Direct(Fld,   [oReal8]);
>     Direct(Fisttp,[oMq]);
>     Direct(Fst,   [oReal8]);
>     Direct(Fstp,  [oReal8]);
>     Direct(Frstor,[oFPEnv]);
>     Invalid;
>     Direct(Fsave ,[oFPEnv]);
>     Direct(Fstsw, [oMw])|]),
>   Group([|
>     LowFun(fun st -> Ffree, [oSt_of_int st]);
>     Invalid;
>     LowFun(fun st -> Fst,   [oSt_of_int st]);
>     LowFun(fun st -> Fstp,  [oSt_of_int st]);
>     LowFun(fun st -> Fucom, [oSt_of_int st]);
>     LowFun(fun st -> Fucomp,[oSt_of_int st]);
1021,1037c891,907
<     Direct(Fiadd, [OMw]);
<     Direct(Fimul, [OMw]);
<     Direct(Ficom, [OMw]);
<     Direct(Ficomp,[OMw]);
<     Direct(Fisub, [OMw]);
<     Direct(Fisubr,[OMw]);
<     Direct(Fidiv, [OMw]);
<     Direct(Fidivr,[OMw])|]),
<   Group([|
<     Direct(Faddp, [OStN;OSt0]);
<     Direct(Fmulp, [OStN;OSt0]);
<     Invalid;
<     LowGroup([|Invalid;Direct(Fcompp,[]);Invalid;Invalid;Invalid;Invalid;Invalid;Invalid|]);
<     Direct(Fsubrp,[OStN;OSt0]);
<     Direct(Fsubp, [OStN;OSt0]);
<     Direct(Fdivrp,[OStN;OSt0]);
<     Direct(Fdivp, [OStN;OSt0])|])));
---
>     Direct(Fiadd, [oMw]);
>     Direct(Fimul, [oMw]);
>     Direct(Ficom, [oMw]);
>     Direct(Ficomp,[oMw]);
>     Direct(Fisub, [oMw]);
>     Direct(Fisubr,[oMw]);
>     Direct(Fidiv, [oMw]);
>     Direct(Fidivr,[oMw])|]),
>   Group([|
>     LowFun(fun st -> Faddp, [oSt_of_int st;oSt0]);
>     LowFun(fun st -> Fmulp, [oSt_of_int st;oSt0]);
>     Invalid;
>     LowFun(function | 1 -> Fcompp,[] | _ -> invalid ());
>     LowFun(fun st -> Fsubrp,[oSt_of_int st;oSt0]);
>     LowFun(fun st -> Fsubp, [oSt_of_int st;oSt0]);
>     LowFun(fun st -> Fdivrp,[oSt_of_int st;oSt0]);
>     LowFun(fun st -> Fdivp, [oSt_of_int st;oSt0])|])));
1041,1048c911,918
<     Direct(Fild,  [OMw]);
<     Direct(Fisttp,[OMw]);
<     Direct(Fist,  [OMw]);
<     Direct(Fistp, [OMw]);
<     Direct(Fbld,  [OReal10]);
<     Direct(Fild,  [OReal8]);
<     Direct(Fbstp, [OReal10]);
<     Direct(Fistp, [OReal8])|]),
---
>     Direct(Fild,  [oMw]);
>     Direct(Fisttp,[oMw]);
>     Direct(Fist,  [oMw]);
>     Direct(Fistp, [oMw]);
>     Direct(Fbld,  [oReal10]);
>     Direct(Fild,  [oReal8]);
>     Direct(Fbstp, [oReal10]);
>     Direct(Fistp, [oReal8])|]),
1054,1056c924,926
<     LowGroup([|Direct(Fstsw,[OAX]);Invalid;Invalid;Invalid;Invalid;Invalid;Invalid;Invalid|]);
<     Direct(Fucomip,[OSt0;OStN]);
<     Direct(Fcomip, [OSt0;OStN]);
---
>     LowFun(function | 0 -> Fstsw,[oAX] | _ -> invalid ());
>     LowFun(fun st -> Fucomip,[oSt0;oSt_of_int st]);
>     LowFun(fun st -> Fcomip, [oSt0;oSt_of_int st]);
1059,1074c929,944
< Direct(Loopnz,[OJb]); (* 0xE0 *)
< Direct(Loopz,[OJb]);
< Direct(Loop,[OJb]);
< Predicated(PRED_AddrSize(Direct(Jcxz,[OJb]),Direct(Jecxz,[OJb])));
< Direct(In,[OAL;OIb]);
< Direct(In,[OeAX;OIb]);
< Direct(Out,[OIb;OAL]);
< Direct(Out,[OIb;OeAX]);
< Direct(Call,[OJz]);
< Direct(Jmp,[OJz]);
< Direct(JmpF,[OAp]);
< Direct(Jmp,[OJb]);
< Direct(In,[OAL;ODX]);
< Direct(In,[OeAX;ODX]);
< Direct(Out,[ODX;OAL]);
< Direct(Out,[ODX;OeAX]);
---
> Direct(Loopnz,[oJb]); (* 0xE0 *)
> Direct(Loopz,[oJb]);
> Direct(Loop,[oJb]);
> Predicated(PRED_AddrSize(Direct(Jcxz,[oJb]),Direct(Jecxz,[oJb])));
> Direct(In,[oAL;oIb]);
> Direct(In,[oeAX;oIb]);
> Direct(Out,[oIb;oAL]);
> Direct(Out,[oIb;oeAX]);
> Direct(Call,[oJz]);
> Direct(Jmp,[oJz]);
> Direct(JmpF,[oAp]);
> Direct(Jmp,[oJb]);
> Direct(In,[oAL;oDX]);
> Direct(In,[oeAX;oDX]);
> Direct(Out,[oDX;oAL]);
> Direct(Out,[oDX;oeAX]);
1081,1082c951,952
< Group([|Direct(Test,[OEb;OIb]);Invalid;Direct(Not,[OEb]);Direct(Neg,[OEb]);Direct(Mul,[OEb]);Direct(Imul,[OEb]);Direct(Div,[OEb]);Direct(Idiv,[OEb])|]);
< Group([|Direct(Test,[OEv;OIz]);Invalid;Direct(Not,[OEv]);Direct(Neg,[OEv]);Direct(Mul,[OEv]);Direct(Imul,[OEv]);Direct(Div,[OEv]);Direct(Idiv,[OEv])|]);
---
> Group([|Direct(Test,[oEb;oIb]);Invalid;Direct(Not,[oEb]);Direct(Neg,[oEb]);Direct(Mul,[oEb]);Direct(Imul,[oEb]);Direct(Div,[oEb]);Direct(Idiv,[oEb])|]);
> Group([|Direct(Test,[oEv;oIz]);Invalid;Direct(Not,[oEv]);Direct(Neg,[oEv]);Direct(Mul,[oEv]);Direct(Imul,[oEv]);Direct(Div,[oEv]);Direct(Idiv,[oEv])|]);
1089,1090c959,960
< Group([|Direct(Inc,[OEb]);Direct(Dec,[OEb]);Invalid;Invalid;Invalid;Invalid;Invalid;Invalid;|]);
< Group([|Direct(Inc,[OEv]);Direct(Dec,[OEv]);Direct(Call,[OEv]);Direct(CallF,[OEv]);Direct(Jmp,[OEv]);Direct(JmpF,[OEv]);Direct(Push,[OEv]);Invalid;|]);
---
> Group([|Direct(Inc,[oEb]);Direct(Dec,[oEb]);Invalid;Invalid;Invalid;Invalid;Invalid;Invalid;|]);
> Group([|Direct(Inc,[oEv]);Direct(Dec,[oEv]);Direct(Call,[oEv]);Direct(CallF,[oEv]);Direct(Jmp,[oEv]);Direct(JmpF,[oEv]);Direct(Push,[oEv]);Invalid;|]);
1093,1098c963,968
<   Predicated(PRED_ModRMMemReg(Direct(Sldt,[OMw]),Direct(Sldt,[ORv])));
<   Predicated(PRED_ModRMMemReg(Direct(Str ,[OMw]),Direct(Str ,[ORv])));
<   Direct(Lldt,[OEw]);
<   Direct(Ltr ,[OEw]);
<   Direct(Verr,[OEw]);
<   Direct(Verw,[OEw]);
---
>   Predicated(PRED_ModRMMemReg(Direct(Sldt,[oMw]),Direct(Sldt,[oRv])));
>   Predicated(PRED_ModRMMemReg(Direct(Str ,[oMw]),Direct(Str ,[oRv])));
>   Direct(Lldt,[oEw]);
>   Direct(Ltr ,[oEw]);
>   Direct(Verr,[oEw]);
>   Direct(Verw,[oEw]);
1104,1108c974,978
<     Direct(Sgdt,[OMs]);
<     Direct(Sidt,[OMs]);
<     Direct(Lgdt,[OMs]);
<     Direct(Lidt,[OMs]);
<     Direct(Smsw,[OMw]);
---
>     Direct(Sgdt,[oMs]);
>     Direct(Sidt,[oMs]);
>     Direct(Lgdt,[oMs]);
>     Direct(Lidt,[oMs]);
>     Direct(Smsw,[oMw]);
1110,1111c980,981
<     Direct(Lmsw,[OMw]);
<     Direct(Invlpg,[OMb]);|]),
---
>     Direct(Lmsw,[oMw]);
>     Direct(Invlpg,[oMb]);|]),
1122c992
<     LowGroup([|Direct(Monitor,[]);Direct(Mwait,[]);Invalid;Invalid;Invalid;Invalid;Invalid;Invalid|]);
---
>     LowFun(function | 0 -> Monitor,[] | 1 -> Mwait,[] | _ -> invalid ());
1125c995
<     Direct(Smsw,[ORv]);
---
>     Direct(Smsw,[oRv]);
1127c997
<     Direct(Lmsw,[ORw]);
---
>     Direct(Lmsw,[oRw]);
1131,1132c1001,1002
< Direct(Lar,[OGv;OEw]);
< Direct(Lsl,[OGv;OEw]);
---
> Direct(Lar,[oGv;oEw]);
> Direct(Lsl,[oGv;oEw]);
1142c1012
< Direct(Nop,[OEv]);
---
> Direct(Nop,[oEv]);
1145,1153c1015,1023
< Sse(Direct(Movups,[OVps;OWps]),Direct(Movss, [OVss;OWss]),Direct(Movupd,[OVpd;OWpd]),Direct(Movsd, [OVsd;OWsd])); (* 0x110 *)
< Sse(Direct(Movups,[OWps;OVps]),Direct(Movss, [OWss;OVss]),Direct(Movupd,[OWpd;OVpd]),Direct(Movsd, [OWsd;OVsd]));
< Sse(Predicated(PRED_ModRMMemReg(Direct(Movlps,[OVq;OMq]),Direct(Movhlps,[OVq;OUq]))),Direct(Movsldup,[OVq;OWq]),Direct(Movlpd,[OVq;OMq]),Direct(Movddup,[OVq;OWq]));
< SseNo66(Direct(Movlps,[OMq;OVq]),Direct(Movlpd,[OMq;OVq]));
< SseNo66(Direct(Unpcklpd,[OVpd;OWq]),Direct(Unpcklps,[OVps;OWq]));
< SseNo66(Direct(Unpckhpd,[OVpd;OWq]),Direct(Unpckhps,[OVps;OWq]));
< Sse(Predicated(PRED_ModRMMemReg(Direct(Movhps,[OVq;OMq]),Direct(Movlhps,[OVq;OUq]))),Direct(Movshdup,[OVq;OWq]),Direct(Movhpd,[OVq;OMq]),Invalid);
< SseNo66(Direct(Movhps,[OMq;OVq]),Direct(Movhpd,[OMq;OVq]));
< Predicated(PRED_ModRMMemReg(Group[|Direct(Prefetchnta,[OMb]);Direct(Prefetcht0,[OMb]);Direct(Prefetcht1,[OMb]);Direct(Prefetcht2,[OMb]);Invalid;Invalid;Invalid;Invalid|],Invalid));
---
> Sse(Direct(Movups,[oVps;oWps]),Direct(Movss, [oVss;oWss]),Direct(Movupd,[oVpd;oWpd]),Direct(Movsd, [oVsd;oWsd])); (* 0x110 *)
> Sse(Direct(Movups,[oWps;oVps]),Direct(Movss, [oWss;oVss]),Direct(Movupd,[oWpd;oVpd]),Direct(Movsd, [oWsd;oVsd]));
> Sse(Predicated(PRED_ModRMMemReg(Direct(Movlps,[oVq;oMq]),Direct(Movhlps,[oVq;oUq]))),Direct(Movsldup,[oVq;oWq]),Direct(Movlpd,[oVq;oMq]),Direct(Movddup,[oVq;oWq]));
> SseNo66(Direct(Movlps,[oMq;oVq]),Direct(Movlpd,[oMq;oVq]));
> SseNo66(Direct(Unpcklpd,[oVpd;oWq]),Direct(Unpcklps,[oVps;oWq]));
> SseNo66(Direct(Unpckhpd,[oVpd;oWq]),Direct(Unpckhps,[oVps;oWq]));
> Sse(Predicated(PRED_ModRMMemReg(Direct(Movhps,[oVq;oMq]),Direct(Movlhps,[oVq;oUq]))),Direct(Movshdup,[oVq;oWq]),Direct(Movhpd,[oVq;oMq]),Invalid);
> SseNo66(Direct(Movhps,[oMq;oVq]),Direct(Movhpd,[oMq;oVq]));
> Predicated(PRED_ModRMMemReg(Group[|Direct(Prefetchnta,[oMb]);Direct(Prefetcht0,[oMb]);Direct(Prefetcht1,[oMb]);Direct(Prefetcht2,[oMb]);Invalid;Invalid;Invalid;Invalid|],Invalid));
1160,1164c1030,1034
< Direct(Nop,[OEv]);
< Direct(Mov,[ORd;OCd]); (* 0x120 *)
< Direct(Mov,[ORd;ODd]);
< Direct(Mov,[OCd;ORd]);
< Direct(Mov,[ODd;ORd]);
---
> Direct(Nop,[oEv]);
> Direct(Mov,[oRd;oCd]); (* 0x120 *)
> Direct(Mov,[oRd;oDd]);
> Direct(Mov,[oCd;oRd]);
> Direct(Mov,[oDd;oRd]);
1169,1176c1039,1046
< SseNo66(Direct(Movaps,[OVpd;OWpd]),Direct(Movapd,[OVps;OWps]));
< SseNo66(Direct(Movaps,[OWpd;OVpd]),Direct(Movapd,[OWps;OVps]));
< Sse(Direct(Cvtpi2ps,[OVps;OQpi]),Direct(Cvtsi2ss,[OVss;OEd_q]),Direct(Cvtpi2pd,[OVpd;OQpi]),Direct(Cvtsi2sd,[OVsd;OEd_q]));
< SseNo66(Direct(Movntps,[OMpd;OVpd]),Direct(Movntpd,[OMps;OVps]));
< Sse(Direct(Cvttps2pi,[OPpi;OWps]),Direct(Cvttss2si,[OGd;OWss]),Direct(Cvttpd2pi,[OPpi;OWpd]),Direct(Cvttsd2si,[OGd;OWsd]));
< Sse(Direct(Cvtps2pi,[OPpi;OWps]),Direct(Cvtss2si,[OGd_q;OWss]),Direct(Cvtpd2pi,[OPpi;OWpd]),Direct(Cvtsd2si,[OGd_q;OWsd]));
< SseNo66(Direct(Ucomiss,[OVsd;OWsd]),Direct(Ucomisd,[OVss;OWss]));
< SseNo66(Direct(Comiss, [OVsd;OWsd]),Direct(Comisd, [OVss;OWss]));
---
> SseNo66(Direct(Movaps,[oVpd;oWpd]),Direct(Movapd,[oVps;oWps]));
> SseNo66(Direct(Movaps,[oWpd;oVpd]),Direct(Movapd,[oWps;oVps]));
> Sse(Direct(Cvtpi2ps,[oVps;oQpi]),Direct(Cvtsi2ss,[oVss;oEd_q]),Direct(Cvtpi2pd,[oVpd;oQpi]),Direct(Cvtsi2sd,[oVsd;oEd_q]));
> SseNo66(Direct(Movntps,[oMpd;oVpd]),Direct(Movntpd,[oMps;oVps]));
> Sse(Direct(Cvttps2pi,[oPpi;oWps]),Direct(Cvttss2si,[oGd;oWss]),Direct(Cvttpd2pi,[oPpi;oWpd]),Direct(Cvttsd2si,[oGd;oWsd]));
> Sse(Direct(Cvtps2pi,[oPpi;oWps]),Direct(Cvtss2si,[oGd_q;oWss]),Direct(Cvtpd2pi,[oPpi;oWpd]),Direct(Cvtsd2si,[oGd_q;oWsd]));
> SseNo66(Direct(Ucomiss,[oVsd;oWsd]),Direct(Ucomisd,[oVss;oWss]));
> SseNo66(Direct(Comiss, [oVsd;oWsd]),Direct(Comisd, [oVss;oWss]));
1193,1241c1063,1111
< Direct(Cmovo ,[OGv;OEv]); (* 0x140 *)
< Direct(Cmovno,[OGv;OEv]);
< Direct(Cmovb ,[OGv;OEv]);
< Direct(Cmovae,[OGv;OEv]);
< Direct(Cmovz ,[OGv;OEv]);
< Direct(Cmovnz,[OGv;OEv]);
< Direct(Cmovbe,[OGv;OEv]);
< Direct(Cmova ,[OGv;OEv]);
< Direct(Cmovs ,[OGv;OEv]);
< Direct(Cmovns,[OGv;OEv]);
< Direct(Cmovp ,[OGv;OEv]);
< Direct(Cmovnp,[OGv;OEv]);
< Direct(Cmovl ,[OGv;OEv]);
< Direct(Cmovge,[OGv;OEv]);
< Direct(Cmovle,[OGv;OEv]);
< Direct(Cmovg ,[OGv;OEv]);
< SseNo66(Direct(Movmskps,[OGd;OUps]),Direct(Movmskpd,[OGd;OUpd])); (* 0x150 *)
< Sse(Direct(Sqrtps,    [OVps;OWps]),Direct(Sqrtss,   [OVss;OWss]),Direct(Sqrtpd,    [OVpd;OWpd]),Direct(Sqrtsd,  [OVsd;OWsd]));
< Sse(Direct(Rsqrtps,   [OVps;OWps]),Direct(Rsqrtss,  [OVss;OWss]),Invalid,                       Invalid);
< Sse(Direct(Rcpps,     [OVps;OWps]),Direct(Rcpss,    [OVss;OWss]),Invalid,                       Invalid);
< SseNo66(Direct(Andps, [OVps;OWps]),Direct(Andpd,    [OVpd;OWpd]));
< SseNo66(Direct(Andnps,[OVps;OWps]),Direct(Andnpd,   [OVpd;OWpd]));
< SseNo66(Direct(Orps,  [OVps;OWps]),Direct(Orpd,     [OVpd;OWpd]));
< SseNo66(Direct(Xorps, [OVps;OWps]),Direct(Xorpd,    [OVpd;OWpd]));
< Sse(Direct(Addps,     [OVps;OWps]),Direct(Addss,    [OVss;OWss]),Direct(Addpd,     [OVpd;OWpd]),Direct(Addsd,   [OVsd;OWsd]));
< Sse(Direct(Mulps,     [OVps;OWps]),Direct(Mulss,    [OVss;OWss]),Direct(Mulpd,     [OVpd;OWpd]),Direct(Mulsd,   [OVsd;OWsd]));
< Sse(Direct(Cvtps2pd,  [OVpd;OWps]),Direct(Cvtss2sd, [OVss;OWss]),Direct(Cvtpd2ps,  [OVps;OWpd]),Direct(Cvtsd2ss,[OVsd;OWsd]));
< Sse(Direct(Cvtdq2ps,  [OVps;OWps]),Direct(Cvttps2dq,[OVdq;OWps]),Direct(Cvtps2dq,  [OVdq;OWps]),Invalid);
< Sse(Direct(Subps,     [OVps;OWps]),Direct(Subss,    [OVss;OWss]),Direct(Subpd,     [OVpd;OWpd]),Direct(Subsd,   [OVsd;OWsd]));
< Sse(Direct(Minps,     [OVps;OWps]),Direct(Minss,    [OVss;OWss]),Direct(Minpd,     [OVpd;OWpd]),Direct(Minsd,   [OVsd;OWsd]));
< Sse(Direct(Divps,     [OVps;OWps]),Direct(Divss,    [OVss;OWss]),Direct(Divpd,     [OVpd;OWpd]),Direct(Divsd,   [OVsd;OWsd]));
< Sse(Direct(Maxps,     [OVps;OWps]),Direct(Maxss,    [OVss;OWss]),Direct(Maxpd,     [OVpd;OWpd]),Direct(Maxsd,   [OVsd;OWsd]));
< SseNo66(Direct(Punpcklbw,[OPq;OQd]),Direct(Punpcklbw,[OVdq;OWdq])); (* 0x160 *)
< SseNo66(Direct(Punpcklwd,[OPq;OQd]),Direct(Punpcklwd,[OVdq;OWdq]));
< SseNo66(Direct(Punpckldq,[OPq;OQd]),Direct(Punpckldq,[OVdq;OWdq]));
< SseNo66(Direct(Packsswb, [OPq;OQd]),Direct(Packsswb, [OVdq;OWdq]));
< SseNo66(Direct(Pcmpgtb,  [OPq;OQd]),Direct(Pcmpgtb,  [OVdq;OWdq]));
< SseNo66(Direct(Pcmpgtw,  [OPq;OQd]),Direct(Pcmpgtw,  [OVdq;OWdq]));
< SseNo66(Direct(Pcmpgtd,  [OPq;OQd]),Direct(Pcmpgtd,  [OVdq;OWdq]));
< SseNo66(Direct(Packuswb, [OPq;OQd]),Direct(Packuswb, [OVdq;OWdq]));
< SseNo66(Direct(Punpckhbw,[OPq;OQd]),Direct(Punpckhbw,[OVdq;OWdq]));
< SseNo66(Direct(Punpckhwd,[OPq;OQd]),Direct(Punpckhwd,[OVdq;OWdq]));
< SseNo66(Direct(Punpckhdq,[OPq;OQd]),Direct(Punpckhdq,[OVdq;OWdq]));
< SseNo66(Direct(Packssdw, [OPq;OQd]),Direct(Packssdw, [OVdq;OWdq]));
< Sse66(Direct(Punpcklqdq,[OVdq;OWdq]));
< Sse66(Direct(Punpckhqdq,[OVdq;OWdq]));
< SseNo66(Direct(Movd,[OPd;OEd_q]),Direct(Movd,[OVdq;OEd_q]));  (* Revisit on 64-bit *)
< Sse(Direct(Movq,     [OPq ;OQq ]),Direct(Movdqu,   [OVdq;OWdq]),Direct(Movdqa,    [OVdq;OWdq]),Invalid);
< Sse(Direct(Pshufw,   [OPq;OQq;OIb]),Direct(Pshufhw,[OVdq;OWdq;OIb]),Direct(Pshufd,[OVdq;OWdq;OIb]),Direct(Pshuflw,[OVdq;OWdq;OIb]));(* 0x170 *)
---
> Direct(Cmovo ,[oGv;oEv]); (* 0x140 *)
> Direct(Cmovno,[oGv;oEv]);
> Direct(Cmovb ,[oGv;oEv]);
> Direct(Cmovae,[oGv;oEv]);
> Direct(Cmovz ,[oGv;oEv]);
> Direct(Cmovnz,[oGv;oEv]);
> Direct(Cmovbe,[oGv;oEv]);
> Direct(Cmova ,[oGv;oEv]);
> Direct(Cmovs ,[oGv;oEv]);
> Direct(Cmovns,[oGv;oEv]);
> Direct(Cmovp ,[oGv;oEv]);
> Direct(Cmovnp,[oGv;oEv]);
> Direct(Cmovl ,[oGv;oEv]);
> Direct(Cmovge,[oGv;oEv]);
> Direct(Cmovle,[oGv;oEv]);
> Direct(Cmovg ,[oGv;oEv]);
> SseNo66(Direct(Movmskps,[oGd;oUps]),Direct(Movmskpd,[oGd;oUpd])); (* 0x150 *)
> Sse(Direct(Sqrtps,    [oVps;oWps]),Direct(Sqrtss,   [oVss;oWss]),Direct(Sqrtpd,    [oVpd;oWpd]),Direct(Sqrtsd,  [oVsd;oWsd]));
> Sse(Direct(Rsqrtps,   [oVps;oWps]),Direct(Rsqrtss,  [oVss;oWss]),Invalid,                       Invalid);
> Sse(Direct(Rcpps,     [oVps;oWps]),Direct(Rcpss,    [oVss;oWss]),Invalid,                       Invalid);
> SseNo66(Direct(Andps, [oVps;oWps]),Direct(Andpd,    [oVpd;oWpd]));
> SseNo66(Direct(Andnps,[oVps;oWps]),Direct(Andnpd,   [oVpd;oWpd]));
> SseNo66(Direct(Orps,  [oVps;oWps]),Direct(Orpd,     [oVpd;oWpd]));
> SseNo66(Direct(Xorps, [oVps;oWps]),Direct(Xorpd,    [oVpd;oWpd]));
> Sse(Direct(Addps,     [oVps;oWps]),Direct(Addss,    [oVss;oWss]),Direct(Addpd,     [oVpd;oWpd]),Direct(Addsd,   [oVsd;oWsd]));
> Sse(Direct(Mulps,     [oVps;oWps]),Direct(Mulss,    [oVss;oWss]),Direct(Mulpd,     [oVpd;oWpd]),Direct(Mulsd,   [oVsd;oWsd]));
> Sse(Direct(Cvtps2pd,  [oVpd;oWps]),Direct(Cvtss2sd, [oVss;oWss]),Direct(Cvtpd2ps,  [oVps;oWpd]),Direct(Cvtsd2ss,[oVsd;oWsd]));
> Sse(Direct(Cvtdq2ps,  [oVps;oWps]),Direct(Cvttps2dq,[oVdq;oWps]),Direct(Cvtps2dq,  [oVdq;oWps]),Invalid);
> Sse(Direct(Subps,     [oVps;oWps]),Direct(Subss,    [oVss;oWss]),Direct(Subpd,     [oVpd;oWpd]),Direct(Subsd,   [oVsd;oWsd]));
> Sse(Direct(Minps,     [oVps;oWps]),Direct(Minss,    [oVss;oWss]),Direct(Minpd,     [oVpd;oWpd]),Direct(Minsd,   [oVsd;oWsd]));
> Sse(Direct(Divps,     [oVps;oWps]),Direct(Divss,    [oVss;oWss]),Direct(Divpd,     [oVpd;oWpd]),Direct(Divsd,   [oVsd;oWsd]));
> Sse(Direct(Maxps,     [oVps;oWps]),Direct(Maxss,    [oVss;oWss]),Direct(Maxpd,     [oVpd;oWpd]),Direct(Maxsd,   [oVsd;oWsd]));
> SseNo66(Direct(Punpcklbw,[oPq;oQd]),Direct(Punpcklbw,[oVdq;oWdq])); (* 0x160 *)
> SseNo66(Direct(Punpcklwd,[oPq;oQd]),Direct(Punpcklwd,[oVdq;oWdq]));
> SseNo66(Direct(Punpckldq,[oPq;oQd]),Direct(Punpckldq,[oVdq;oWdq]));
> SseNo66(Direct(Packsswb, [oPq;oQd]),Direct(Packsswb, [oVdq;oWdq]));
> SseNo66(Direct(Pcmpgtb,  [oPq;oQd]),Direct(Pcmpgtb,  [oVdq;oWdq]));
> SseNo66(Direct(Pcmpgtw,  [oPq;oQd]),Direct(Pcmpgtw,  [oVdq;oWdq]));
> SseNo66(Direct(Pcmpgtd,  [oPq;oQd]),Direct(Pcmpgtd,  [oVdq;oWdq]));
> SseNo66(Direct(Packuswb, [oPq;oQd]),Direct(Packuswb, [oVdq;oWdq]));
> SseNo66(Direct(Punpckhbw,[oPq;oQd]),Direct(Punpckhbw,[oVdq;oWdq]));
> SseNo66(Direct(Punpckhwd,[oPq;oQd]),Direct(Punpckhwd,[oVdq;oWdq]));
> SseNo66(Direct(Punpckhdq,[oPq;oQd]),Direct(Punpckhdq,[oVdq;oWdq]));
> SseNo66(Direct(Packssdw, [oPq;oQd]),Direct(Packssdw, [oVdq;oWdq]));
> Sse66(Direct(Punpcklqdq,[oVdq;oWdq]));
> Sse66(Direct(Punpckhqdq,[oVdq;oWdq]));
> SseNo66(Direct(Movd,[oPd;oEd_q]),Direct(Movd,[oVdq;oEd_q]));  (* Revisit on 64-bit *)
> Sse(Direct(Movq,     [oPq ;oQq ]),Direct(Movdqu,   [oVdq;oWdq]),Direct(Movdqa,    [oVdq;oWdq]),Invalid);
> Sse(Direct(Pshufw,   [oPq;oQq;oIb]),Direct(Pshufhw,[oVdq;oWdq;oIb]),Direct(Pshufd,[oVdq;oWdq;oIb]),Direct(Pshuflw,[oVdq;oWdq;oIb]));(* 0x170 *)
1248c1118
<     SseNo66(Direct(Psrlw,[ONq;OIb]),Direct(Psrlw,[OUdq;OIb]));
---
>     SseNo66(Direct(Psrlw,[oNq;oIb]),Direct(Psrlw,[oUdq;oIb]));
1250c1120
<     SseNo66(Direct(Psraw,[ONq;OIb]),Direct(Psraw,[OUdq;OIb]));
---
>     SseNo66(Direct(Psraw,[oNq;oIb]),Direct(Psraw,[oUdq;oIb]));
1252c1122
<     SseNo66(Direct(Psllw,[ONq;OIb]),Direct(Psllw,[OUdq;OIb]));
---
>     SseNo66(Direct(Psllw,[oNq;oIb]),Direct(Psllw,[oUdq;oIb]));
1260c1130
<     SseNo66(Direct(Psrld,[ONq;OIb]),Direct(Psrld,[OUdq;OIb]));
---
>     SseNo66(Direct(Psrld,[oNq;oIb]),Direct(Psrld,[oUdq;oIb]));
1262c1132
<     SseNo66(Direct(Psrad,[ONq;OIb]),Direct(Psrad,[OUdq;OIb]));
---
>     SseNo66(Direct(Psrad,[oNq;oIb]),Direct(Psrad,[oUdq;oIb]));
1264c1134
<     SseNo66(Direct(Pslld,[ONq;OIb]),Direct(Pslld,[OUdq;OIb]));
---
>     SseNo66(Direct(Pslld,[oNq;oIb]),Direct(Pslld,[oUdq;oIb]));
1272,1273c1142,1143
<     SseNo66(Direct(Psrlq,[ONq;OIb]),Direct(Psrlq,[OUdq;OIb]));
<     Sse66(Direct(Psrldq,[OUdq;OIb]));
---
>     SseNo66(Direct(Psrlq,[oNq;oIb]),Direct(Psrlq,[oUdq;oIb]));
>     Sse66(Direct(Psrldq,[oUdq;oIb]));
1276,1277c1146,1147
<     SseNo66(Direct(Psllq,[ONq;OIb]),Direct(Psllq,[OUdq;OIb]));
<     Sse66(Direct(Pslldq,[OUdq;OIb]));|])));
---
>     SseNo66(Direct(Psllq,[oNq;oIb]),Direct(Psllq,[oUdq;oIb]));
>     Sse66(Direct(Pslldq,[oUdq;oIb]));|])));
1279,1281c1149,1151
< SseNo66(Direct(Pcmpeqb,[OPq;OQq]),Direct(Pcmpeqb,[OVdq;OWdq]));
< SseNo66(Direct(Pcmpeqw,[OPq;OQq]),Direct(Pcmpeqw,[OVdq;OWdq]));
< SseNo66(Direct(Pcmpeqd,[OPq;OQq]),Direct(Pcmpeqd,[OVdq;OWdq]));
---
> SseNo66(Direct(Pcmpeqb,[oPq;oQq]),Direct(Pcmpeqb,[oVdq;oWdq]));
> SseNo66(Direct(Pcmpeqw,[oPq;oQq]),Direct(Pcmpeqw,[oVdq;oWdq]));
> SseNo66(Direct(Pcmpeqd,[oPq;oQq]),Direct(Pcmpeqd,[oVdq;oWdq]));
1283,1284c1153,1154
< Direct(Vmread,[OEd;OGd]);  (* revisit for 64-bit *)
< Direct(Vmwrite,[OEd;OGd]); (* revisit for 64-bit *)
---
> Direct(Vmread,[oEd;oGd]);  (* revisit for 64-bit *)
> Direct(Vmwrite,[oEd;oGd]); (* revisit for 64-bit *)
1287,1324c1157,1194
< Sse(Invalid,Invalid,Direct(Haddpd,[OVpd;OWpd]),Direct(Haddps,[OVps;OWps]));
< Sse(Invalid,Invalid,Direct(Hsubpd,[OVpd;OWpd]),Direct(Hsubps,[OVps;OWps]));
< Sse(Direct(Movd,[OEd_q;OPd]),Direct(Movq,[OVq;OWq]),Direct(Movd,[OEd_q;OVdq]),Invalid); (* Revisit on 64-bit *)
< Sse(Direct(Movq,[OQq;OPq]),Direct(Movdqu,[OWdq;OVdq]),Direct(Movdqa,[OWdq;OVdq]),Invalid);
< Direct(Jo ,[OJz]); (* 0x180 *)
< Direct(Jno,[OJz]);
< Direct(Jb ,[OJz]);
< Direct(Jae,[OJz]);
< Direct(Jz ,[OJz]);
< Direct(Jnz,[OJz]);
< Direct(Jbe,[OJz]);
< Direct(Ja ,[OJz]);
< Direct(Js ,[OJz]);
< Direct(Jns,[OJz]);
< Direct(Jp ,[OJz]);
< Direct(Jnp,[OJz]);
< Direct(Jl ,[OJz]);
< Direct(Jge,[OJz]);
< Direct(Jle,[OJz]);
< Direct(Jg ,[OJz]);
< Direct(Seto ,[OEb]); (* 0x190 *)
< Direct(Setno,[OEb]);
< Direct(Setb ,[OEb]);
< Direct(Setae,[OEb]);
< Direct(Setz ,[OEb]);
< Direct(Setnz,[OEb]);
< Direct(Setbe,[OEb]);
< Direct(Seta ,[OEb]);
< Direct(Sets ,[OEb]);
< Direct(Setns,[OEb]);
< Direct(Setp ,[OEb]);
< Direct(Setnp,[OEb]);
< Direct(Setl ,[OEb]);
< Direct(Setge,[OEb]);
< Direct(Setle,[OEb]);
< Direct(Setg ,[OEb]);
< Direct(Push,[OFS]); (* 0x1A0 *)
< Direct(Pop,[OFS]);
---
> Sse(Invalid,Invalid,Direct(Haddpd,[oVpd;oWpd]),Direct(Haddps,[oVps;oWps]));
> Sse(Invalid,Invalid,Direct(Hsubpd,[oVpd;oWpd]),Direct(Hsubps,[oVps;oWps]));
> Sse(Direct(Movd,[oEd_q;oPd]),Direct(Movq,[oVq;oWq]),Direct(Movd,[oEd_q;oVdq]),Invalid); (* Revisit on 64-bit *)
> Sse(Direct(Movq,[oQq;oPq]),Direct(Movdqu,[oWdq;oVdq]),Direct(Movdqa,[oWdq;oVdq]),Invalid);
> Direct(Jo ,[oJz]); (* 0x180 *)
> Direct(Jno,[oJz]);
> Direct(Jb ,[oJz]);
> Direct(Jae,[oJz]);
> Direct(Jz ,[oJz]);
> Direct(Jnz,[oJz]);
> Direct(Jbe,[oJz]);
> Direct(Ja ,[oJz]);
> Direct(Js ,[oJz]);
> Direct(Jns,[oJz]);
> Direct(Jp ,[oJz]);
> Direct(Jnp,[oJz]);
> Direct(Jl ,[oJz]);
> Direct(Jge,[oJz]);
> Direct(Jle,[oJz]);
> Direct(Jg ,[oJz]);
> Direct(Seto ,[oEb]); (* 0x190 *)
> Direct(Setno,[oEb]);
> Direct(Setb ,[oEb]);
> Direct(Setae,[oEb]);
> Direct(Setz ,[oEb]);
> Direct(Setnz,[oEb]);
> Direct(Setbe,[oEb]);
> Direct(Seta ,[oEb]);
> Direct(Sets ,[oEb]);
> Direct(Setns,[oEb]);
> Direct(Setp ,[oEb]);
> Direct(Setnp,[oEb]);
> Direct(Setl ,[oEb]);
> Direct(Setge,[oEb]);
> Direct(Setle,[oEb]);
> Direct(Setg ,[oEb]);
> Direct(Push,[oFS]); (* 0x1A0 *)
> Direct(Pop,[oFS]);
1326,1328c1196,1198
< Direct(Bt,[OEv;OGv]);
< Direct(Shld,[OEv;OGv;OIb]);
< Direct(Shld,[OEv;OGv;OCL]);
---
> Direct(Bt,[oEv;oGv]);
> Direct(Shld,[oEv;oGv;oIb]);
> Direct(Shld,[oEv;oGv;oCL]);
1331,1332c1201,1202
< Direct(Push,[OGS]);
< Direct(Pop,[OGS]);
---
> Direct(Push,[oGS]);
> Direct(Pop,[oGS]);
1334,1336c1204,1206
< Direct(Bts,[OEv;OGv]);
< Direct(Shrd,[OEv;OGv;OIb]);
< Direct(Shrd,[OEv;OGv;OCL]);
---
> Direct(Bts,[oEv;oGv]);
> Direct(Shrd,[oEv;oGv;oIb]);
> Direct(Shrd,[oEv;oGv;oCL]);
1339,1342c1209,1212
<     Direct(Fxsave,[OSimdState]);
<     Direct(Fxrstor,[OSimdState]);
<     Direct(Ldmxcsr,[OMd]);
<     Direct(Stmxcsr,[OMd]);
---
>     Direct(Fxsave,[oSimdState]);
>     Direct(Fxrstor,[oSimdState]);
>     Direct(Ldmxcsr,[oMd]);
>     Direct(Stmxcsr,[oMd]);
1346c1216
<     Direct(Clflush,[OMb])|]),
---
>     Direct(Clflush,[oMb])|]),
1357,1366c1227,1236
< Direct(Imul,[OGv;OEv]);
< Direct(Cmpxchg,[OEb;OGb]); (* 0x1B0 *)
< Direct(Cmpxchg,[OEv;OGv]);
< Direct(Lss,[OGv;OMp]);
< Direct(Btr,[OEv;OGv]);
< Direct(Lfs,[OGv;OMp]);
< Direct(Lgs,[OGv;OMp]);
< Direct(Movzx,[OGv;OEb]);
< Direct(Movzx,[OGv;OEw]);
< Direct(Popcnt,[OGv;OEv]);
---
> Direct(Imul,[oGv;oEv]);
> Direct(Cmpxchg,[oEb;oGb]); (* 0x1B0 *)
> Direct(Cmpxchg,[oEv;oGv]);
> Direct(Lss,[oGv;oMp]);
> Direct(Btr,[oEv;oGv]);
> Direct(Lfs,[oGv;oMp]);
> Direct(Lgs,[oGv;oMp]);
> Direct(Movzx,[oGv;oEb]);
> Direct(Movzx,[oGv;oEw]);
> Direct(Popcnt,[oGv;oEv]);
1368,1380c1238,1250
< Group([|Invalid;Invalid;Invalid;Invalid;Direct(Bt ,[OEv;OIb]);Direct(Bts,[OEv;OIb]);Direct(Btr,[OEv;OIb]);Direct(Btc,[OEv;OIb])|]);
< Direct(Btc,[OEv;OGv]);
< Direct(Bsf,[OGv;OEv]);
< Direct(Bsr,[OGv;OEv]);
< Direct(Movsx,[OGv;OEb]);
< Direct(Movsx,[OGv;OEw]);
< Direct(Xadd,[OEb;OGb]);  (* 0x1C0 *)
< Direct(Xadd,[OEv;OGv]);
< Sse(Direct(Cmpps,[OVps;OWps;OIb]),Direct(Cmpss,[OVss;OWss;OIb]),Direct(Cmppd,[OVpd;OWpd;OIb]),Direct(Cmpsd,[OVsd;OWsd;OIb]));
< SseNo(Direct(Movnti,[OMd_q;OGd_q]));
< SseNo66(Direct(Pinsrw,[OPq;OEw;OIb]),  Direct(Pinsrw,[OVdq;OEw;OIb]));
< SseNo66(Direct(Pextrw,[OGd;ONq;OIb]),  Direct(Pextrw,[OGd;OUdq;OIb]));
< SseNo66(Direct(Shufps,[OVps;OWps;OIb]),Direct(Shufpd,[OVps;OWps;OIb]));
---
> Group([|Invalid;Invalid;Invalid;Invalid;Direct(Bt ,[oEv;oIb]);Direct(Bts,[oEv;oIb]);Direct(Btr,[oEv;oIb]);Direct(Btc,[oEv;oIb])|]);
> Direct(Btc,[oEv;oGv]);
> Direct(Bsf,[oGv;oEv]);
> Direct(Bsr,[oGv;oEv]);
> Direct(Movsx,[oGv;oEb]);
> Direct(Movsx,[oGv;oEw]);
> Direct(Xadd,[oEb;oGb]);  (* 0x1C0 *)
> Direct(Xadd,[oEv;oGv]);
> Sse(Direct(Cmpps,[oVps;oWps;oIb]),Direct(Cmpss,[oVss;oWss;oIb]),Direct(Cmppd,[oVpd;oWpd;oIb]),Direct(Cmpsd,[oVsd;oWsd;oIb]));
> SseNo(Direct(Movnti,[oMd_q;oGd_q]));
> SseNo66(Direct(Pinsrw,[oPq;oEw;oIb]),  Direct(Pinsrw,[oVdq;oEw;oIb]));
> SseNo66(Direct(Pextrw,[oGd;oNq;oIb]),  Direct(Pextrw,[oGd;oUdq;oIb]));
> SseNo66(Direct(Shufps,[oVps;oWps;oIb]),Direct(Shufpd,[oVps;oWps;oIb]));
1384c1254
<     Direct(Cmpxchg8b,[OMq]); (* Revisit on 64-bit *)
---
>     Direct(Cmpxchg8b,[oMq]); (* Revisit on 64-bit *)
1389,1390c1259,1260
<     Sse(Direct(Vmptrld,[OMq]),Direct(Vmxon,[OMq]),Direct(Vmclear,[OMq]),Invalid);
<     SseNo(Direct(Vmptrst,[OMq]))|]),
---
>     Sse(Direct(Vmptrld,[oMq]),Direct(Vmxon,[oMq]),Direct(Vmclear,[oMq]),Invalid);
>     SseNo(Direct(Vmptrst,[oMq]))|]),
1392,1513c1262,1383
< Direct(Bswap,[OeAX]);
< Direct(Bswap,[OeCX]);
< Direct(Bswap,[OeDX]);
< Direct(Bswap,[OeBX]);
< Direct(Bswap,[OeSP]);
< Direct(Bswap,[OeBP]);
< Direct(Bswap,[OeSI]);
< Direct(Bswap,[OeDI]);
< Sse(Invalid,Invalid,Direct(Addsubpd,[OVpd;OWpd]),Direct(Addsubps,[OVps;OWps])); (* 0x1D0 *)
< SseNo66(Direct(Psrlw, [OPq;OQq]),Direct(Psrlw,  [OVdq;OWdq]));
< SseNo66(Direct(Psrld, [OPq;OQq]),Direct(Psrld,  [OVdq;OWdq]));
< SseNo66(Direct(Psrlq, [OPq;OQq]),Direct(Psrlq,  [OVdq;OWdq]));
< SseNo66(Direct(Paddq, [OPq;OQq]),Direct(Paddq,  [OVdq;OWdq]));
< SseNo66(Direct(Pmullw,[OPq;OQq]),Direct(Pmullw, [OVdq;OWdq]));
< Sse(Invalid,Direct(Movq2dq,[OVdq;ONq]),Direct(Movq,   [OVdq;OWdq]),Direct(Movdq2q,[OPq;OUq]));
< SseNo66(Direct(Pmovmskb,[OGd;ONq]),Direct(Pmovmskb,[OGd;OUdq]));
< SseNo66(Direct(Psubusb,[OPq;OQq]), Direct(Psubusb,[OVdq;OWdq]));
< SseNo66(Direct(Psubusw,[OPq;OQq]), Direct(Psubusw,[OVdq;OWdq]));
< SseNo66(Direct(Pminub, [OPq;OQq]), Direct(Pminub, [OVdq;OWdq]));
< SseNo66(Direct(Pand,   [OPq;OQq]), Direct(Pand,   [OVdq;OWdq]));
< SseNo66(Direct(Paddusb,[OPq;OQq]), Direct(Paddusb,[OVdq;OWdq]));
< SseNo66(Direct(Paddusw,[OPq;OQq]), Direct(Paddusw,[OVdq;OWdq]));
< SseNo66(Direct(Pmaxub, [OPq;OQq]), Direct(Pmaxub, [OVdq;OWdq]));
< SseNo66(Direct(Pandn,  [OPq;OQq]), Direct(Pandn,  [OVdq;OWdq]));
< SseNo66(Direct(Pavgb,  [OPq;OQq]), Direct(Pavgb,  [OVdq;OWdq])); (* 0x1E0 *)
< SseNo66(Direct(Psraw,  [OPq;OQq]), Direct(Psraw,  [OVdq;OWdq]));
< SseNo66(Direct(Psrad,  [OPq;OQq]), Direct(Psrad,  [OVdq;OWdq]));
< SseNo66(Direct(Pavgw,  [OPq;OQq]), Direct(Pavgw,  [OVdq;OWdq]));
< SseNo66(Direct(Pmulhuw,[OPq;OQq]), Direct(Pmulhuw,[OVdq;OWdq]));
< SseNo66(Direct(Pmulhw, [OPq;OQq]), Direct(Pmulhw, [OVdq;OWdq]));
< Sse(Invalid,Direct(Cvtdq2pd,[OVpd;OWdq]),Direct(Cvttpd2dq,[OVdq;OWpd]),Direct(Cvtpd2dq,[OVdq;OWpd]));
< SseNo66(Direct(Movntq,[OMq;OPq]),  Direct(Movntdq,[OMdq;OVdq]));
< SseNo66(Direct(Psubsb, [OPq;OQq]), Direct(Psubsb, [OVdq;OWdq]));
< SseNo66(Direct(Psubsw, [OPq;OQq]), Direct(Psubsw, [OVdq;OWdq]));
< SseNo66(Direct(Pminsw, [OPq;OQq]), Direct(Pminsw, [OVdq;OWdq]));
< SseNo66(Direct(Por,    [OPq;OQq]), Direct(Por,    [OVdq;OWdq]));
< SseNo66(Direct(Paddsb, [OPq;OQq]), Direct(Paddsb, [OVdq;OWdq]));
< SseNo66(Direct(Paddsw, [OPq;OQq]), Direct(Paddsw, [OVdq;OWdq]));
< SseNo66(Direct(Pmaxsw, [OPq;OQq]), Direct(Pmaxsw, [OVdq;OWdq]));
< SseNo66(Direct(Pxor,   [OPq;OQq]), Direct(Pxor,   [OVdq;OWdq]));
< Sse(Invalid,Invalid,Invalid,Direct(Lddqu,[OVdq;OMdq])); (* 0x1F0 *)
< SseNo66(Direct(Psllw,   [OPq;OQq]),Direct(Psllw,     [OVdq;OWdq]));
< SseNo66(Direct(Pslld,   [OPq;OQq]),Direct(Pslld,     [OVdq;OWdq]));
< SseNo66(Direct(Psllq,   [OPq;OQq]),Direct(Psllq,     [OVdq;OWdq]));
< SseNo66(Direct(Pmuludq, [OPq;OQq]),Direct(Pmuludq,   [OVdq;OWdq]));
< SseNo66(Direct(Pmaddwd, [OPq;OQq]),Direct(Pmaddwd,   [OVdq;OWdq]));
< SseNo66(Direct(Psadbw,  [OPq;OQq]),Direct(Psadbw,    [OVdq;OWdq]));
< SseNo66(Direct(Maskmovq,[OPq;ONq]),Direct(Maskmovdqu,[OVdq;OUdq]));
< SseNo66(Direct(Psubb,   [OPq;OQq]),Direct(Psubb,     [OVdq;OWdq]));
< SseNo66(Direct(Psubw,   [OPq;OQq]),Direct(Psubw,     [OVdq;OWdq]));
< SseNo66(Direct(Psubd,   [OPq;OQq]),Direct(Psubd,     [OVdq;OWdq]));
< SseNo66(Direct(Psubq,   [OPq;OQq]),Direct(Psubq,     [OVdq;OWdq]));
< SseNo66(Direct(Paddb,   [OPq;OQq]),Direct(Paddb,     [OVdq;OWdq]));
< SseNo66(Direct(Paddw,   [OPq;OQq]),Direct(Paddw,     [OVdq;OWdq]));
< SseNo66(Direct(Paddd,   [OPq;OQq]),Direct(Paddd,     [OVdq;OWdq]));
< Invalid;
< SseNo66(Direct(Pshufb,   [OPq;OQq]),Direct(Pshufb,   [OVdq;OWdq])); (* 0x200 *)
< SseNo66(Direct(Phaddw,   [OPq;OQq]),Direct(Phaddw,   [OVdq;OWdq]));
< SseNo66(Direct(Phaddd,   [OPq;OQq]),Direct(Phaddd,   [OVdq;OWdq]));
< SseNo66(Direct(Phaddsw,  [OPq;OQq]),Direct(Phaddsw,  [OVdq;OWdq]));
< SseNo66(Direct(Pmaddubsw,[OPq;OQq]),Direct(Pmaddubsw,[OVdq;OWdq]));
< SseNo66(Direct(Phsubw,   [OPq;OQq]),Direct(Phsubw,   [OVdq;OWdq]));
< SseNo66(Direct(Phsubd,   [OPq;OQq]),Direct(Phsubd,   [OVdq;OWdq]));
< SseNo66(Direct(Phsubsw,  [OPq;OQq]),Direct(Phsubsw,  [OVdq;OWdq]));
< SseNo66(Direct(Psignb,   [OPq;OQq]),Direct(Psignb,   [OVdq;OWdq]));
< SseNo66(Direct(Psignw,   [OPq;OQq]),Direct(Psignw,   [OVdq;OWdq]));
< SseNo66(Direct(Psignd,   [OPq;OQq]),Direct(Psignd,   [OVdq;OWdq]));
< SseNo66(Direct(Pmulhrsw, [OPq;OQq]),Direct(Pmulhrsw, [OVdq;OWdq]));
< Invalid;
< Invalid;
< Invalid;
< Invalid;
< Sse66(Direct(Pblendvb,[OVdq;OWdq])); (* 0x210 *)
< Invalid;
< Invalid;
< Invalid;
< Sse66(Direct(Blendvps,[OVdq;OWdq]));
< Sse66(Direct(Blendvpd,[OVdq;OWdq]));
< Invalid;
< Sse66(Direct(Ptest,[OVdq;OWdq]));
< Invalid;
< Invalid;
< Invalid;
< Invalid;
< SseNo66(Direct(Pabsb,[OPq;OQq]),Direct(Pabsb,[OVdq;OWdq]));
< SseNo66(Direct(Pabsw,[OPq;OQq]),Direct(Pabsw,[OVdq;OWdq]));
< SseNo66(Direct(Pabsd,[OPq;OQq]),Direct(Pabsd,[OVdq;OWdq]));
< Invalid;
< Sse66(Direct(Pmovsxbw,[OVdq;OUdq_Mq])); (* 0x220 *)
< Sse66(Direct(Pmovsxbd,[OVdq;OUdq_Md]));
< Sse66(Direct(Pmovsxbq,[OVdq;OUdq_Mw]));
< Sse66(Direct(Pmovsxwd,[OVdq;OUdq_Mq]));
< Sse66(Direct(Pmovsxwq,[OVdq;OUdq_Md]));
< Sse66(Direct(Pmovsxdq,[OVdq;OUdq_Mq]));
< Invalid;
< Invalid;
< Sse66(Direct(Pmuldq,  [OVdq;OWdq]));
< Sse66(Direct(Pcmpeqq, [OVdq;OWdq]));
< Sse66(Direct(Movntdqa,[OVdq;OMdq]));
< Sse66(Direct(Packusdw,[OVdq;OWdq]));
< Invalid;
< Invalid;
< Invalid;
< Invalid;
< Sse66(Direct(Pmovzxbw,[OVdq;OUdq_Mq])); (* 0x230 *)
< Sse66(Direct(Pmovzxbd,[OVdq;OUdq_Md]));
< Sse66(Direct(Pmovzxbq,[OVdq;OUdq_Mw]));
< Sse66(Direct(Pmovzxwd,[OVdq;OUdq_Mq]));
< Sse66(Direct(Pmovzxwq,[OVdq;OUdq_Md]));
< Sse66(Direct(Pmovzxdq,[OVdq;OUdq_Mq]));
< Invalid;
< Sse66(Direct(Pcmpgtq,   [OVdq;OWdq]));
< Sse66(Direct(Pminsb,    [OVdq;OWdq]));
< Sse66(Direct(Pminsd,    [OVdq;OWdq]));
< Sse66(Direct(Pminuw,    [OVdq;OWdq]));
< Sse66(Direct(Pminud,    [OVdq;OWdq]));
< Sse66(Direct(Pmaxsb,    [OVdq;OWdq]));
< Sse66(Direct(Pmaxsd,    [OVdq;OWdq]));
< Sse66(Direct(Pmaxuw,    [OVdq;OWdq]));
< Sse66(Direct(Pmaxud,    [OVdq;OWdq]));
< Sse66(Direct(Pmulld,    [OVdq;OWdq])); (* 0x240 *)
< Sse66(Direct(Phminposuw,[OVdq;OWdq]));
---
> Direct(Bswap,[oeAX]);
> Direct(Bswap,[oeCX]);
> Direct(Bswap,[oeDX]);
> Direct(Bswap,[oeBX]);
> Direct(Bswap,[oeSP]);
> Direct(Bswap,[oeBP]);
> Direct(Bswap,[oeSI]);
> Direct(Bswap,[oeDI]);
> Sse(Invalid,Invalid,Direct(Addsubpd,[oVpd;oWpd]),Direct(Addsubps,[oVps;oWps])); (* 0x1D0 *)
> SseNo66(Direct(Psrlw, [oPq;oQq]),Direct(Psrlw,  [oVdq;oWdq]));
> SseNo66(Direct(Psrld, [oPq;oQq]),Direct(Psrld,  [oVdq;oWdq]));
> SseNo66(Direct(Psrlq, [oPq;oQq]),Direct(Psrlq,  [oVdq;oWdq]));
> SseNo66(Direct(Paddq, [oPq;oQq]),Direct(Paddq,  [oVdq;oWdq]));
> SseNo66(Direct(Pmullw,[oPq;oQq]),Direct(Pmullw, [oVdq;oWdq]));
> Sse(Invalid,Direct(Movq2dq,[oVdq;oNq]),Direct(Movq,   [oVdq;oWdq]),Direct(Movdq2q,[oPq;oUq]));
> SseNo66(Direct(Pmovmskb,[oGd;oNq]),Direct(Pmovmskb,[oGd;oUdq]));
> SseNo66(Direct(Psubusb,[oPq;oQq]), Direct(Psubusb,[oVdq;oWdq]));
> SseNo66(Direct(Psubusw,[oPq;oQq]), Direct(Psubusw,[oVdq;oWdq]));
> SseNo66(Direct(Pminub, [oPq;oQq]), Direct(Pminub, [oVdq;oWdq]));
> SseNo66(Direct(Pand,   [oPq;oQq]), Direct(Pand,   [oVdq;oWdq]));
> SseNo66(Direct(Paddusb,[oPq;oQq]), Direct(Paddusb,[oVdq;oWdq]));
> SseNo66(Direct(Paddusw,[oPq;oQq]), Direct(Paddusw,[oVdq;oWdq]));
> SseNo66(Direct(Pmaxub, [oPq;oQq]), Direct(Pmaxub, [oVdq;oWdq]));
> SseNo66(Direct(Pandn,  [oPq;oQq]), Direct(Pandn,  [oVdq;oWdq]));
> SseNo66(Direct(Pavgb,  [oPq;oQq]), Direct(Pavgb,  [oVdq;oWdq])); (* 0x1E0 *)
> SseNo66(Direct(Psraw,  [oPq;oQq]), Direct(Psraw,  [oVdq;oWdq]));
> SseNo66(Direct(Psrad,  [oPq;oQq]), Direct(Psrad,  [oVdq;oWdq]));
> SseNo66(Direct(Pavgw,  [oPq;oQq]), Direct(Pavgw,  [oVdq;oWdq]));
> SseNo66(Direct(Pmulhuw,[oPq;oQq]), Direct(Pmulhuw,[oVdq;oWdq]));
> SseNo66(Direct(Pmulhw, [oPq;oQq]), Direct(Pmulhw, [oVdq;oWdq]));
> Sse(Invalid,Direct(Cvtdq2pd,[oVpd;oWdq]),Direct(Cvttpd2dq,[oVdq;oWpd]),Direct(Cvtpd2dq,[oVdq;oWpd]));
> SseNo66(Direct(Movntq,[oMq;oPq]),  Direct(Movntdq,[oMdq;oVdq]));
> SseNo66(Direct(Psubsb, [oPq;oQq]), Direct(Psubsb, [oVdq;oWdq]));
> SseNo66(Direct(Psubsw, [oPq;oQq]), Direct(Psubsw, [oVdq;oWdq]));
> SseNo66(Direct(Pminsw, [oPq;oQq]), Direct(Pminsw, [oVdq;oWdq]));
> SseNo66(Direct(Por,    [oPq;oQq]), Direct(Por,    [oVdq;oWdq]));
> SseNo66(Direct(Paddsb, [oPq;oQq]), Direct(Paddsb, [oVdq;oWdq]));
> SseNo66(Direct(Paddsw, [oPq;oQq]), Direct(Paddsw, [oVdq;oWdq]));
> SseNo66(Direct(Pmaxsw, [oPq;oQq]), Direct(Pmaxsw, [oVdq;oWdq]));
> SseNo66(Direct(Pxor,   [oPq;oQq]), Direct(Pxor,   [oVdq;oWdq]));
> Sse(Invalid,Invalid,Invalid,Direct(Lddqu,[oVdq;oMdq])); (* 0x1F0 *)
> SseNo66(Direct(Psllw,   [oPq;oQq]),Direct(Psllw,     [oVdq;oWdq]));
> SseNo66(Direct(Pslld,   [oPq;oQq]),Direct(Pslld,     [oVdq;oWdq]));
> SseNo66(Direct(Psllq,   [oPq;oQq]),Direct(Psllq,     [oVdq;oWdq]));
> SseNo66(Direct(Pmuludq, [oPq;oQq]),Direct(Pmuludq,   [oVdq;oWdq]));
> SseNo66(Direct(Pmaddwd, [oPq;oQq]),Direct(Pmaddwd,   [oVdq;oWdq]));
> SseNo66(Direct(Psadbw,  [oPq;oQq]),Direct(Psadbw,    [oVdq;oWdq]));
> SseNo66(Direct(Maskmovq,[oPq;oNq]),Direct(Maskmovdqu,[oVdq;oUdq]));
> SseNo66(Direct(Psubb,   [oPq;oQq]),Direct(Psubb,     [oVdq;oWdq]));
> SseNo66(Direct(Psubw,   [oPq;oQq]),Direct(Psubw,     [oVdq;oWdq]));
> SseNo66(Direct(Psubd,   [oPq;oQq]),Direct(Psubd,     [oVdq;oWdq]));
> SseNo66(Direct(Psubq,   [oPq;oQq]),Direct(Psubq,     [oVdq;oWdq]));
> SseNo66(Direct(Paddb,   [oPq;oQq]),Direct(Paddb,     [oVdq;oWdq]));
> SseNo66(Direct(Paddw,   [oPq;oQq]),Direct(Paddw,     [oVdq;oWdq]));
> SseNo66(Direct(Paddd,   [oPq;oQq]),Direct(Paddd,     [oVdq;oWdq]));
> Invalid;
> SseNo66(Direct(Pshufb,   [oPq;oQq]),Direct(Pshufb,   [oVdq;oWdq])); (* 0x200 *)
> SseNo66(Direct(Phaddw,   [oPq;oQq]),Direct(Phaddw,   [oVdq;oWdq]));
> SseNo66(Direct(Phaddd,   [oPq;oQq]),Direct(Phaddd,   [oVdq;oWdq]));
> SseNo66(Direct(Phaddsw,  [oPq;oQq]),Direct(Phaddsw,  [oVdq;oWdq]));
> SseNo66(Direct(Pmaddubsw,[oPq;oQq]),Direct(Pmaddubsw,[oVdq;oWdq]));
> SseNo66(Direct(Phsubw,   [oPq;oQq]),Direct(Phsubw,   [oVdq;oWdq]));
> SseNo66(Direct(Phsubd,   [oPq;oQq]),Direct(Phsubd,   [oVdq;oWdq]));
> SseNo66(Direct(Phsubsw,  [oPq;oQq]),Direct(Phsubsw,  [oVdq;oWdq]));
> SseNo66(Direct(Psignb,   [oPq;oQq]),Direct(Psignb,   [oVdq;oWdq]));
> SseNo66(Direct(Psignw,   [oPq;oQq]),Direct(Psignw,   [oVdq;oWdq]));
> SseNo66(Direct(Psignd,   [oPq;oQq]),Direct(Psignd,   [oVdq;oWdq]));
> SseNo66(Direct(Pmulhrsw, [oPq;oQq]),Direct(Pmulhrsw, [oVdq;oWdq]));
> Invalid;
> Invalid;
> Invalid;
> Invalid;
> Sse66(Direct(Pblendvb,[oVdq;oWdq])); (* 0x210 *)
> Invalid;
> Invalid;
> Invalid;
> Sse66(Direct(Blendvps,[oVdq;oWdq]));
> Sse66(Direct(Blendvpd,[oVdq;oWdq]));
> Invalid;
> Sse66(Direct(Ptest,[oVdq;oWdq]));
> Invalid;
> Invalid;
> Invalid;
> Invalid;
> SseNo66(Direct(Pabsb,[oPq;oQq]),Direct(Pabsb,[oVdq;oWdq]));
> SseNo66(Direct(Pabsw,[oPq;oQq]),Direct(Pabsw,[oVdq;oWdq]));
> SseNo66(Direct(Pabsd,[oPq;oQq]),Direct(Pabsd,[oVdq;oWdq]));
> Invalid;
> Sse66(Direct(Pmovsxbw,[oVdq;oUdqMq])); (* 0x220 *)
> Sse66(Direct(Pmovsxbd,[oVdq;oUdqMd]));
> Sse66(Direct(Pmovsxbq,[oVdq;oUdqMw]));
> Sse66(Direct(Pmovsxwd,[oVdq;oUdqMq]));
> Sse66(Direct(Pmovsxwq,[oVdq;oUdqMd]));
> Sse66(Direct(Pmovsxdq,[oVdq;oUdqMq]));
> Invalid;
> Invalid;
> Sse66(Direct(Pmuldq,  [oVdq;oWdq]));
> Sse66(Direct(Pcmpeqq, [oVdq;oWdq]));
> Sse66(Direct(Movntdqa,[oVdq;oMdq]));
> Sse66(Direct(Packusdw,[oVdq;oWdq]));
> Invalid;
> Invalid;
> Invalid;
> Invalid;
> Sse66(Direct(Pmovzxbw,[oVdq;oUdqMq])); (* 0x230 *)
> Sse66(Direct(Pmovzxbd,[oVdq;oUdqMd]));
> Sse66(Direct(Pmovzxbq,[oVdq;oUdqMw]));
> Sse66(Direct(Pmovzxwd,[oVdq;oUdqMq]));
> Sse66(Direct(Pmovzxwq,[oVdq;oUdqMd]));
> Sse66(Direct(Pmovzxdq,[oVdq;oUdqMq]));
> Invalid;
> Sse66(Direct(Pcmpgtq,   [oVdq;oWdq]));
> Sse66(Direct(Pminsb,    [oVdq;oWdq]));
> Sse66(Direct(Pminsd,    [oVdq;oWdq]));
> Sse66(Direct(Pminuw,    [oVdq;oWdq]));
> Sse66(Direct(Pminud,    [oVdq;oWdq]));
> Sse66(Direct(Pmaxsb,    [oVdq;oWdq]));
> Sse66(Direct(Pmaxsd,    [oVdq;oWdq]));
> Sse66(Direct(Pmaxuw,    [oVdq;oWdq]));
> Sse66(Direct(Pmaxud,    [oVdq;oWdq]));
> Sse66(Direct(Pmulld,    [oVdq;oWdq])); (* 0x240 *)
> Sse66(Direct(Phminposuw,[oVdq;oWdq]));
1688,1689c1558,1559
< Direct(Crc32,[OGd;OEb]); (* 0x2F0 *)
< Direct(Crc32,[OGd;OEv]);
---
> Direct(Crc32,[oGd;oEb]); (* 0x2F0 *)
> Direct(Crc32,[oGd;oEv]);
1712,1719c1582,1589
< Sse66(Direct(Roundps,[OVdq;OWdq;OIb]));
< Sse66(Direct(Roundpd,[OVdq;OWdq;OIb]));
< Sse66(Direct(Roundss,[OVss;OWss;OIb]));
< Sse66(Direct(Roundsd,[OVsd;OWsd;OIb]));
< Sse66(Direct(Blendps,[OVdq;OWdq;OIb]));
< Sse66(Direct(Blendpd,[OVdq;OWdq;OIb]));
< Sse66(Direct(Pblendw,[OVdq;OWdq;OIb]));
< SseNo66(Direct(Palignr,[OPq;OQq;OIb]),Direct(Palignr,[OVdq;OWdq;OIb]));
---
> Sse66(Direct(Roundps,[oVdq;oWdq;oIb]));
> Sse66(Direct(Roundpd,[oVdq;oWdq;oIb]));
> Sse66(Direct(Roundss,[oVss;oWss;oIb]));
> Sse66(Direct(Roundsd,[oVsd;oWsd;oIb]));
> Sse66(Direct(Blendps,[oVdq;oWdq;oIb]));
> Sse66(Direct(Blendpd,[oVdq;oWdq;oIb]));
> Sse66(Direct(Pblendw,[oVdq;oWdq;oIb]));
> SseNo66(Direct(Palignr,[oPq;oQq;oIb]),Direct(Palignr,[oVdq;oWdq;oIb]));
1724,1727c1594,1597
< Sse66(Direct(Pextrb,   [ORd_Mb;OVdq;OIb]));
< Sse66(Direct(Pextrw,   [ORd_Mw;OVdq;OIb]));
< Sse66(Direct(Pextrd,   [OEd;OVdq;OIb])); (* Revisit for 64-bit *)
< Sse66(Direct(Extractps,[OEd;OVdq;OIb]));
---
> Sse66(Direct(Pextrb,   [oRdMb;oVdq;oIb]));
> Sse66(Direct(Pextrw,   [oRdMw;oVdq;oIb]));
> Sse66(Direct(Pextrd,   [oEd;oVdq;oIb])); (* Revisit for 64-bit *)
> Sse66(Direct(Extractps,[oEd;oVdq;oIb]));
1736,1738c1606,1608
< Sse66(Direct(Pinsrb,  [OVdq;OEd;OIb])); (* 0x320 *)
< Sse66(Direct(Insertps,[OVdq;OUdq_Md;OIb]));
< Sse66(Direct(Pinsrd,  [OVdq;OEd;OIb])); (* Revisit for 64-bit *)
---
> Sse66(Direct(Pinsrb,  [oVdq;oEd;oIb])); (* 0x320 *)
> Sse66(Direct(Insertps,[oVdq;oUdqMd;oIb]));
> Sse66(Direct(Pinsrd,  [oVdq;oEd;oIb])); (* Revisit for 64-bit *)
1768,1770c1638,1640
< Sse66(Direct(Dpps,   [OVdq;OWdq;OIb])); (* 0x340 *)
< Sse66(Direct(Dppd,   [OVdq;OWdq;OIb]));
< Sse66(Direct(Mpsadbw,[OVdq;OWdq;OIb]));
---
> Sse66(Direct(Dpps,   [oVdq;oWdq;oIb])); (* 0x340 *)
> Sse66(Direct(Dppd,   [oVdq;oWdq;oIb]));
> Sse66(Direct(Mpsadbw,[oVdq;oWdq;oIb]));
1800,1803c1670,1673
< Sse66(Direct(Pcmpestrm,[OVdq;OWdq;OIb])); (* 0x360 *)
< Sse66(Direct(Pcmpestri,[OVdq;OWdq;OIb]));
< Sse66(Direct(Pcmpistrm,[OVdq;OWdq;OIb]));
< Sse66(Direct(Pcmpistri,[OVdq;OWdq;OIb]));
---
> Sse66(Direct(Pcmpestrm,[oVdq;oWdq;oIb])); (* 0x360 *)
> Sse66(Direct(Pcmpestri,[oVdq;oWdq;oIb]));
> Sse66(Direct(Pcmpistrm,[oVdq;oWdq;oIb]));
> Sse66(Direct(Pcmpistri,[oVdq;oWdq;oIb]));
2138c2008
<   | Direct(m,l) -> (m,List.map (fun f -> (function_of_x86_abstract_operand f) ()) l)
---
>   | Direct(m,l) -> (m,List.map (fun f -> f ()) l)
2143c2013,2015
<     | PRED_ModRMMemReg(mem,reg) -> modrm_mem_reg_discriminator (lazy (aux mem)) (lazy (aux reg)))
---
>     | PRED_ModRMMemReg(mem,reg) -> modrm_mem_reg_discriminator (lazy (aux mem)) (lazy (aux reg))
>     | PRED_AddrOpSize(w1616,w1632,w3216,w3232) -> addropsize_predicate (lazy (aux w1616)) (lazy (aux w1632)) (lazy (aux w3216)) (lazy (aux w3232)))
>   | LowFun(f) -> aux (let m,l = f low in Direct(m,l))
2201,2330d2072
< 
< let make_c_disassembler () =
<   let make_hasmodrm () =
<     let _ = Printf.printf "char hasModRM[1024] = \n{\n  " in
<     let print_entry index b =
<      (match b with
<       | true  -> Printf.printf "1;"
<       | false -> Printf.printf "0;");
<       if (index land 0x0f) = 0x0f
<       then 
<         match index with
<         | _ when index < 0x100 -> Printf.printf "  /* 0x%02X */\n  "           (index - 0x00F)
<         | _ when index < 0x200 -> Printf.printf "  /* 0x0F 0x%02X */\n  "      (index - 0x10F)
<         | _ when index < 0x300 -> Printf.printf "  /* 0x0F 0x38 0x%02X */\n  " (index - 0x20F)
<         | _ when index < 0x400 -> Printf.printf "  /* 0x0F 0x3A 0x%02X */\n  " (index - 0x30F)
<         | _ -> ()
<     in
<     Array.iteri print_entry hasModRM;
<     Printf.printf "\n};\n\n"
<   in
<   let print index ip = 
<     let print indent string = 
<       let rec aux i =
<         let _ = assert (indent >= 0) in
<         if i > 0
<         then let _ = Printf.printf "  " in aux (i-1)
<         else ()
<       in 
<       let _ = aux indent in
<       Printf.printf "%s\n" string
<     in
<     print 1 (Printf.sprintf "case 0x%04x:" index);
<     print 1 "{";
<     let rec print_entry il = function
<     | Invalid           -> print il "// invalid"
<     | Fatal             -> print il "// fatal"
<     | Unimplemented(s)  -> print il ("// unimplemented "^s)
<     | Direct(mnem,ops) -> print il ("// "^(X86Disasm.string_of_x86mnem mnem))
<     | Group(arr) -> 
<       print il "switch(modrmcontext.greg)";
<       print il "{";
<       let il2 = il + 1 in
<       let rec aux il i entry = 
<         print il (Printf.sprintf "case %d:" i);
<         print il "{";
<         print_entry (il+1) entry;
<         print il "}";
<         print il "break;";
<         print il ""
<       in 
<       let _ = Array.iteri (aux (il2+1)) arr in
<       print il "}"
<     | Predicated(PRED_OpSize     (w16,w32)) ->
<       print il "int opsize = determine_operand_size(config, &prefixcontext, &modrmcontext);";
<       print il "switch(opsize)";
<       print il "{";
<       let il2 = il + 1 in
<       print il2 "case 16:";
<       print il2 "{";
<       print_entry (il2+1) w16;
<       print il2 "}";
<       print il2 "break;";
<       print il2 "";
<       print il2 "case 32:";
<       print il2 "{";
<       print_entry (il2+1) w32;
<       print il2 "}";
<       print il2 "break;";
<       print il2 "";
<       print il "}"
<     | Predicated(PRED_AddrSize   (w16,w32)) ->
<       print il "int addrsize = determine_address_size(config, &prefixcontext);";
<       print il "switch(addrsize)";
<       print il "{";
<       let il2 = il + 1 in
<       print il2 "case 16:";
<       print il2 "{";
<       print_entry (il2+1) w16;
<       print il2 "}";
<       print il2 "break;";
<       print il2 "";
<       print il2 "case 32:";
<       print il2 "{";
<       print_entry (il2+1) w32;
<       print il2 "}";
<       print il2 "break;";
<       print il2 "";
<       print il "}"
<     | Predicated(PRED_ModRMMemReg(mem,reg)) ->
<       print il "switch(modrmcontext.byte >> 6)";
<       print il "{";
<       let il2 = il + 1 in
<       print il2 "case 3:";
<       print il2 "{";
<       print_entry (il2+1) reg;
<       print il2 "}";
<       print il2 "break;";
<       print il2 "";
<       print il2 "default:";
<       print il2 "{";
<       print_entry (il2+1) mem;
<       print il2 "}";
<       print il2 "break;";
<       print il2 "";
<       print il "}"
<     | LowGroup(arr) -> 
<       print il "switch(modrmcontext.greg)";
<       print il "{";
<       let il2 = il + 1 in
<       let rec aux il i entry = 
<         print il (Printf.sprintf "case %d:" i);
<         print il "{";
<         print_entry (il+1) entry;
<         print il "}";
<         print il "break;";
<         print il ""
<       in 
<       let _ = Array.iteri (aux (il2+1)) arr in
<       print il "}"
<     | Sse(ipno,ipF3,ip66,ipF2) -> print il "// SSE/all"
<     | SseNo(ipno) -> print il "// SSE/no"
<     | Sse66(ip66) -> print il "// SSE/66"
<     | SseNo66(ipno,ip66) -> print il "// SSE/no,66"
<     in print_entry 2 ip;
<     print 1 "}";
<     print 1 "break;";
<     print 0 ""
<   in
<   make_hasmodrm ();
<   Array.iteri print x86_instruction_production_table
